<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Anvil</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet"/>
  {% if user %}
  <meta id="anvil-user-meta" data-name="{{ user.name }}" data-avatar="{{ user.avatar }}">
  {% endif %}
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0a0a0a;
      --surface: #111111;
      --border: #1f1f1f;
      --border-bright: #2e2e2e;
      --accent: #ff4d00;
      --accent2: #ffcc00;
      --text: #b0b0b0;
      --text-bright: #f0f0f0;
      --text-dim: #444;
      --mono: 'DM Mono', monospace;
      --sans: 'DM Sans', sans-serif;
      --display: 'Bebas Neue', sans-serif;

      /* Tool palettes */
      --roaster: #0077b5;
      --roaster-glow: rgba(0, 119, 181, 0.15);
      --idea: #ff6b6b;
      --idea-glow: rgba(255, 107, 107, 0.15);
      --stack: #00e676;
      --stack-glow: rgba(0, 230, 118, 0.15);
      --resume: #a855f7;
      --resume-glow: rgba(168, 85, 247, 0.15);
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--sans);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Noise overlay */
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='1'/%3E%3C/svg%3E");
      opacity: 0.035;
      pointer-events: none;
      z-index: 999;
    }

    /* Geometric wires canvas — hero only */
    #fire-canvas {
      position: absolute;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      width: 100%;
      height: 100%;
    }

    /* NAV */
    nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 48px;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      background: rgba(10,10,10,0.92);
      backdrop-filter: blur(12px);
      z-index: 100;
    }

    .nav-logo {
      font-family: var(--display);
      font-size: 22px;
      letter-spacing: 0.05em;
      color: var(--text-bright);
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 0px;
      line-height: 1;
    }

    .nav-logo-name {
      font-family: var(--display);
      font-size: 22px;
      letter-spacing: 0.05em;
      color: var(--text-bright);
    }

    .nav-logo span { color: var(--accent); }

    .nav-logo-tagline {
      font-family: var(--mono);
      font-size: 8px;
      letter-spacing: 0.35em;
      text-transform: uppercase;
      color: var(--accent);
      margin-top: 2px;
      vertical-align: super;
    }

    .nav-sparks {
      display: flex;
      gap: 3px;
      align-items: flex-end;
      height: 12px;
      margin-bottom: 3px;
    }

    .nav-sparks span {
      display: block;
      width: 2px;
      border-radius: 2px;
      background: var(--accent);
      animation: navFlicker 1.4s ease-in-out infinite;
    }

    .nav-sparks span:nth-child(1) { height: 5px;  animation-delay: 0.0s; }
    .nav-sparks span:nth-child(2) { height: 9px;  animation-delay: 0.15s; }
    .nav-sparks span:nth-child(3) { height: 12px; animation-delay: 0.05s; }
    .nav-sparks span:nth-child(4) { height: 7px;  animation-delay: 0.2s; }
    .nav-sparks span:nth-child(5) { height: 4px;  animation-delay: 0.1s; }

    @keyframes navFlicker {
      0%, 100% { opacity: 1; transform: scaleY(1); }
      50% { opacity: 0.5; transform: scaleY(0.7); }
    }

    .nav-links {
      display: flex;
      gap: 32px;
      list-style: none;
    }

    .nav-auth { display: flex; align-items: center; gap: 12px; }

    .nav-login-btn {
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing: 0.15em;
      color: var(--accent);
      border: 1px solid var(--accent);
      padding: 6px 14px;
      text-decoration: none;
      transition: background 0.2s, color 0.2s;
    }
    .nav-login-btn:hover { background: var(--accent); color: #000; }

    .nav-user { display: flex; align-items: center; gap: 10px; }
    .nav-avatar {
      width: 36px; height: 36px;
      border-radius: 50%;
      border: 2px solid var(--accent);
      object-fit: cover;
    }
    .nav-username {
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing: 0.1em;
      color: var(--text);
    }
    .nav-logout-btn {
      font-family: var(--mono);
      font-size: 11px;
      color: var(--text-dim);
      text-decoration: none;
      transition: color 0.2s;
      cursor: pointer;
      border: 1px solid transparent;
      padding: 4px 8px;
      letter-spacing: 0.1em;
      position: relative;
    }
    .nav-logout-btn:hover { color: #ff4444; border-color: #ff4444; }
    .nav-logout-btn .logout-label { display: none; }
    .nav-logout-btn:hover .logout-arrow { display: none; }
    .nav-logout-btn:hover .logout-label { display: inline; }

    .nav-links a {
      font-family: var(--mono);
      font-size: 12px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--text-dim);
      text-decoration: none;
      transition: color 0.2s;
    }

    .nav-links a:hover { color: var(--accent); }

    /* HUD */
    .hud {
      padding: 0 48px;
      background: rgba(17,17,17,0.95);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: stretch;
      gap: 0;
      position: sticky;
      top: 80px;
      z-index: 99;
      backdrop-filter: blur(12px);
    }

    .hud-block {
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 14px 28px;
      border-right: 1px solid var(--border);
      gap: 6px;
      min-width: 140px;
    }

    .hud-block:last-child { border-right: none; flex: 1; }

    .hud-label {
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--text-dim);
    }

    .hud-value {
      font-family: var(--display);
      font-size: 22px;
      letter-spacing: 0.05em;
      line-height: 1;
    }

    .hud-level .hud-value { color: var(--accent2); }
    .hud-streak .hud-value { color: #ff6b35; }
    .hud-uses .hud-value { color: #00e5ff; }
    .hud-xp .hud-value { color: var(--accent); }

    .hud-streak-fire,
    .fire-animated {
      display: inline-block;
      animation: fireFlicker 0.8s ease-in-out infinite alternate;
      transform-origin: bottom center;
    }

    .hud-streak-fire { font-size: 14px; margin-left: 4px; }
    .fire-animated { font-size: 32px; margin-left: 6px; }

    @keyframes fireFlicker {
      0%   { transform: scale(1) rotate(-5deg); opacity: 0.85; }
      50%  { transform: scale(1.2) rotate(3deg); opacity: 1; }
      100% { transform: scale(1.05) rotate(-2deg); opacity: 0.9; }
    }

    /* XP Progress in HUD */
    .hud-xp-block {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 14px 28px;
      gap: 8px;
    }

    .hud-xp-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .hud-xp-label {
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--text-dim);
    }

    .hud-xp-points {
      font-family: var(--mono);
      font-size: 10px;
      color: var(--accent);
      letter-spacing: 0.05em;
    }

    .hud-xp-track {
      width: 100%;
      height: 6px;
      background: var(--border);
      position: relative;
      overflow: hidden;
    }

    .hud-xp-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      transition: width 0.8s cubic-bezier(0.22, 1, 0.36, 1);
      position: relative;
    }

    .hud-xp-fill::after {
      content: '';
      position: absolute;
      top: 0; right: 0;
      width: 20px; height: 100%;
      background: white;
      opacity: 0.4;
      filter: blur(4px);
    }

    /* XP Float animation */
    .xp-float {
      position: fixed;
      font-family: var(--display);
      font-size: 24px;
      color: var(--accent2);
      pointer-events: none;
      z-index: 9999;
      animation: floatUp 1.2s ease forwards;
      text-shadow: 0 0 20px rgba(255,204,0,0.8);
    }

    @keyframes floatUp {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-80px) scale(1.3); }
    }

    /* Level up banner */
    .levelup-banner {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.8);
      background: var(--surface);
      border: 2px solid var(--accent2);
      padding: 32px 64px;
      text-align: center;
      z-index: 9998;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s;
      box-shadow: 0 0 60px rgba(255,204,0,0.3);
    }

    .levelup-banner.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
      pointer-events: all;
    }

    .unlock-banner {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.85);
      background: #0f0f0f;
      border: 1px solid #00e676;
      border-radius: 16px;
      padding: 32px 48px;
      text-align: center;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s;
      box-shadow: 0 0 60px rgba(0,230,118,0.2);
    }

    .unlock-banner.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
      pointer-events: all;
    }

    .unlock-title {
      font-family: var(--display);
      font-size: 48px;
      color: #00e676;
      letter-spacing: 0.1em;
    }

    .unlock-sub {
      font-family: var(--mono);
      font-size: 12px;
      color: var(--text-dim);
      letter-spacing: 0.15em;
      margin-top: 8px;
    }

    /* Locked comic options in dropdowns */
    select option.locked-option {
      color: #444;
    }

    .levelup-title {
      font-family: var(--display);
      font-size: 48px;
      color: var(--accent2);
      letter-spacing: 0.1em;
    }

    .levelup-sub {
      font-family: var(--mono);
      font-size: 12px;
      color: var(--text-dim);
      letter-spacing: 0.15em;
      margin-top: 8px;
    }

    /* HERO */
    .hero {
      padding: 80px 48px 60px;
      max-width: 1200px;
      margin: 0 auto;
      transition: transform 0.06s linear, opacity 0.06s linear;
      will-change: transform, opacity;
      position: relative;
      z-index: 1;
      overflow: hidden;
    }

    /* Hero split layout */
    .hero-split {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 48px;
      align-items: start;
      position: relative;
      z-index: 2;
    }

    .hero-left { display: flex; flex-direction: column; }
    .hero-right { padding-top: 24px; }

    /* Todo panel */
    .todo-panel {
      background: var(--surface);
      border: 1px solid var(--border-bright);
      display: flex;
      flex-direction: column;
    }

    .todo-header { border-bottom: 1px solid var(--border); }

    .todo-tabs {
      display: flex;
    }

    .todo-tab {
      flex: 1;
      background: none;
      border: none;
      border-bottom: 2px solid transparent;
      color: var(--text-dim);
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 0.15em;
      padding: 14px 16px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
    }
    .todo-tab:hover { color: var(--text); }
    .todo-tab.active { color: var(--accent); border-bottom-color: var(--accent); }

    .todo-section { display: none; padding: 16px; }
    .todo-section.active { display: block; }

    .todo-add {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .todo-add input {
      flex: 1;
      background: var(--bg);
      border: 1px solid var(--border-bright);
      color: var(--text-bright);
      font-family: var(--mono);
      font-size: 12px;
      padding: 8px 12px;
      outline: none;
      transition: border-color 0.2s;
    }
    .todo-add input:focus { border-color: var(--accent); }
    .todo-add input::placeholder { color: var(--text-dim); }

    .todo-add-btn {
      background: var(--accent);
      border: none;
      color: #fff;
      font-size: 20px;
      width: 36px;
      cursor: pointer;
      transition: background 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .todo-add-btn:hover { background: #ff6620; }

    .todo-list { list-style: none; display: flex; flex-direction: column; gap: 4px; max-height: 280px; overflow-y: auto; }

    .todo-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 10px;
      background: var(--bg);
      border: 1px solid var(--border);
      transition: border-color 0.2s;
      animation: fadeUp 0.2s ease both;
    }
    .todo-item:hover { border-color: var(--border-bright); }

    .todo-check {
      font-family: var(--mono);
      font-size: 12px;
      color: var(--text-dim);
      cursor: pointer;
      flex-shrink: 0;
      width: 16px;
      transition: color 0.2s;
    }
    .todo-item.done .todo-check { color: var(--accent); }

    .todo-text {
      font-family: var(--mono);
      font-size: 12px;
      color: var(--text);
      flex: 1;
      transition: all 0.2s;
    }
    .todo-item.done .todo-text { text-decoration: line-through; color: var(--text-dim); }

    .todo-delete {
      background: none;
      border: none;
      color: var(--text-dim);
      font-size: 14px;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.2s, color 0.2s;
      padding: 0 2px;
    }
    .todo-item:hover .todo-delete { opacity: 1; }
    .todo-delete:hover { color: #ff4444; }

    .todo-empty {
      font-family: var(--mono);
      font-size: 11px;
      color: var(--text-dim);
      letter-spacing: 0.1em;
      text-align: center;
      padding: 24px 0;
    }

    /* Roadmap items */
    .roadmap-list { max-height: 320px; }
    .roadmap-item { cursor: default; }
    .roadmap-item.done .todo-check { color: #00e676; }
    .roadmap-item:not(.done) .todo-check { color: var(--text-dim); }

    /* Tool card zip-in animation */
    

    @keyframes zipIn {
      0%   { opacity: 0; transform: translateY(60px) scale(0.97); }
      60%  { transform: translateY(-8px) scale(1.01); }
      80%  { transform: translateY(4px) scale(0.99); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }

    .hero-eyebrow {
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .hero-eyebrow::before {
      content: '';
      display: inline-block;
      width: 24px;
      height: 1px;
      background: var(--accent);
    }

    .hero-heading-block {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 20px;
    }

    .hero-sparks {
      display: flex;
      gap: 5px;
      align-items: flex-end;
      height: 36px;
      margin-bottom: 16px;
    }

    .hero-sparks span {
      display: block;
      width: 4px;
      border-radius: 3px;
      background: var(--accent);
      animation: heroFlicker 1.4s ease-in-out infinite;
    }

    .hero-sparks span:nth-child(1) { height: 14px; animation-delay: 0.0s; }
    .hero-sparks span:nth-child(2) { height: 26px; animation-delay: 0.15s; }
    .hero-sparks span:nth-child(3) { height: 36px; animation-delay: 0.05s; }
    .hero-sparks span:nth-child(4) { height: 20px; animation-delay: 0.2s; }
    .hero-sparks span:nth-child(5) { height: 12px; animation-delay: 0.1s; }

    @keyframes heroFlicker {
      0%, 100% { opacity: 1; transform: scaleY(1); }
      50% { opacity: 0.45; transform: scaleY(0.75); }
    }

    .hero-tagline {
      font-family: var(--mono);
      font-size: 13px;
      letter-spacing: 0.45em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 20px;
      display: block;
    }

    .hero h1 {
      font-family: var(--display);
      font-size: clamp(64px, 10vw, 120px);
      line-height: 0.95;
      letter-spacing: 0.02em;
      color: var(--text-bright);
      margin-bottom: 4px;
    }

    .hero-sub {
      font-size: 16px;
      color: var(--text);
      font-weight: 300;
      max-width: 480px;
      line-height: 1.7;
      margin-bottom: 48px;
    }

    .hero-stats {
      display: flex;
      gap: 0;
      margin-top: 8px;
    }

    .stat {
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding: 20px 32px;
      border: 1px solid var(--border);
      position: relative;
      transition: border-color 0.2s, background 0.2s;
      min-width: 140px;
    }

    .stat:hover {
      border-color: var(--border-bright);
      background: var(--surface);
    }

    .stat:not(:last-child) { border-right: none; }

    .stat-num {
      font-family: var(--display);
      font-size: 40px;
      line-height: 1;
    }

    .stat-uses .stat-num { color: #00e5ff; }
    .stat-streak .stat-num { color: #ff6b35; }
    .stat-xp .stat-num { color: var(--accent); }

    .stat-label {
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-dim);
    }

    /* LOGOUT CONFIRM */
    .logout-confirm-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }
    .logout-confirm-overlay.show {
      opacity: 1;
      pointer-events: all;
    }
    .logout-confirm-box {
      background: var(--surface);
      border: 1px solid #ff4444;
      padding: 36px 48px;
      text-align: center;
      box-shadow: 0 0 40px rgba(255,68,68,0.15);
    }
    .logout-confirm-title {
      font-family: var(--display);
      font-size: 28px;
      color: var(--text-bright);
      letter-spacing: 0.05em;
      margin-bottom: 8px;
    }
    .logout-confirm-sub {
      font-family: var(--mono);
      font-size: 11px;
      color: var(--text-dim);
      letter-spacing: 0.1em;
      margin-bottom: 28px;
    }
    .logout-confirm-btns {
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    .logout-btn-cancel {
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing: 0.12em;
      padding: 10px 24px;
      background: none;
      border: 1px solid var(--border-bright);
      color: var(--text);
      cursor: pointer;
      transition: border-color 0.2s, color 0.2s;
    }
    .logout-btn-cancel:hover { border-color: var(--text); }
    .logout-btn-confirm {
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing: 0.12em;
      padding: 10px 24px;
      background: #ff4444;
      border: 1px solid #ff4444;
      color: #fff;
      cursor: pointer;
      transition: background 0.2s;
    }
    .logout-btn-confirm:hover { background: #cc0000; border-color: #cc0000; }

    /* HAMBURGER + DRAWER */
    .hamburger {
      display: none;
      flex-direction: column;
      gap: 5px;
      cursor: pointer;
      background: none;
      border: none;
      padding: 4px;
      z-index: 201;
    }
    .hamburger span {
      display: block;
      width: 22px;
      height: 2px;
      background: var(--text-bright);
      border-radius: 2px;
      transition: all 0.3s;
    }
    .hamburger.open span:nth-child(1) { transform: translateY(7px) rotate(45deg); }
    .hamburger.open span:nth-child(2) { opacity: 0; }
    .hamburger.open span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }

    .drawer-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      z-index: 199;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      backdrop-filter: blur(4px);
    }
    .drawer-overlay.open { opacity: 1; pointer-events: all; }

    .drawer {
      position: fixed;
      top: 0; left: 0; bottom: 0;
      width: 280px;
      background: var(--surface);
      border-right: 1px solid var(--border-bright);
      z-index: 200;
      transform: translateX(-100%);
      transition: transform 0.3s cubic-bezier(0.22, 1, 0.36, 1);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .drawer.open { transform: translateX(0); }

    .drawer-header {
      padding: 24px 24px 20px;
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }
    .drawer-logo {
      font-family: var(--display);
      font-size: 24px;
      color: var(--text-bright);
      letter-spacing: 0.05em;
    }
    .drawer-logo span { color: var(--accent); }
    .drawer-tagline {
      font-family: var(--mono);
      font-size: 8px;
      letter-spacing: 0.3em;
      color: var(--accent);
      margin-top: 2px;
    }

    .drawer-nav {
      padding: 16px 0;
      flex: 1;
      display: flex;
      flex-direction: column;
      width: 100%;
      overflow-y: auto;
    }

    .drawer-link {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px 24px;
      font-family: var(--mono);
      font-size: 12px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-dim);
      text-decoration: none;
      cursor: pointer;
      transition: color 0.2s, background 0.2s;
      border: none;
      border-bottom: 1px solid var(--border);
      background: none;
      width: 100%;
      box-sizing: border-box;
      text-align: left;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .drawer-link:hover { color: var(--accent); background: rgba(255,77,0,0.05); }
    .drawer-link-icon { font-size: 16px; width: 20px; text-align: center; flex-shrink: 0; }

    .drawer-footer {
      padding: 20px 24px;
      border-top: 1px solid var(--border);
      font-family: var(--mono);
      font-size: 9px;
      color: var(--text-dim);
      letter-spacing: 0.1em;
      flex-shrink: 0;
    }

    @media (max-width: 768px) {
      .hamburger { display: flex; }
    }

    /* NAV AUTHOR TAG */
    .nav-author-tag {
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 0.12em;
      color: var(--text-dim);
      border: 1px solid var(--border-bright);
      padding: 3px 8px;
      margin-left: 10px;
      align-self: center;
      white-space: nowrap;
      transition: color 0.2s, border-color 0.2s;
    }
    .nav-author-tag:hover { color: var(--accent); border-color: var(--accent); }

    /* HERO TAGLINE ROW */
    .hero-tagline-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    .hero-tagline { margin-bottom: 0; }
    .hero-byline {
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing: 0.15em;
      color: var(--text-dim);
      white-space: nowrap;
    }

    /* ABOUT — GLITCH */
    .about-section {
      padding: 0 48px 64px;
      max-width: 1100px;
      margin: 0 auto;
    }

    .about-glitch-wrap {
      border: 1px solid var(--border-bright);
      background: var(--surface);
      position: relative;
      overflow: hidden;
    }

    .about-glitch-wrap::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(255,77,0,0.015) 2px,
        rgba(255,77,0,0.015) 4px
      );
      pointer-events: none;
      z-index: 0;
    }

    .about-glitch-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 20px;
      border-bottom: 1px solid var(--border);
      background: rgba(255,77,0,0.04);
    }

    .about-glitch-tag {
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 0.18em;
      color: var(--accent);
    }

    .about-glitch-status {
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 0.2em;
      color: #00e676;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .about-status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #00e676;
      animation: statusPulse 2s ease-in-out infinite;
    }

    @keyframes statusPulse {
      0%, 100% { opacity: 1; box-shadow: 0 0 6px #00e676; }
      50% { opacity: 0.4; box-shadow: none; }
    }

    .about-glitch-body {
      display: flex;
      position: relative;
      z-index: 1;
    }

    .about-glitch-line-nums {
      display: flex;
      flex-direction: column;
      gap: 0;
      padding: 28px 16px 28px 20px;
      border-right: 1px solid var(--border);
      background: rgba(0,0,0,0.2);
      user-select: none;
    }

    .about-glitch-line-nums span {
      font-family: var(--mono);
      font-size: 11px;
      color: var(--text-dim);
      line-height: 2.05;
      opacity: 0.4;
    }

    .about-glitch-content {
      flex: 1;
      padding: 28px 40px;
      position: relative;
    }

    .about-glitch-text {
      font-size: 15px;
      color: var(--text);
      line-height: 2.05;
      font-weight: 300;
      position: relative;
      z-index: 2;
    }

    /* Glitch overlay — red/cyan offset clone */
    .about-glitch-overlay {
      position: absolute;
      top: 28px; left: 40px; right: 40px;
      font-size: 15px;
      line-height: 2.05;
      font-weight: 300;
      font-family: var(--sans);
      color: transparent;
      pointer-events: none;
      z-index: 1;
      animation: glitchShift 6s infinite;
    }

    @keyframes glitchShift {
      0%, 92%, 100% {
        text-shadow: none;
        clip-path: inset(0 0 100% 0);
        transform: translate(0);
      }
      93% {
        clip-path: inset(20% 0 60% 0);
        transform: translate(-3px, 0);
        text-shadow: 2px 0 #ff4d00, -2px 0 #00e5ff;
      }
      95% {
        clip-path: inset(50% 0 20% 0);
        transform: translate(3px, 0);
        text-shadow: -2px 0 #ff4d00, 2px 0 #00e5ff;
      }
      97% {
        clip-path: inset(10% 0 75% 0);
        transform: translate(-2px, 0);
        text-shadow: 2px 0 #ff4d00, -2px 0 #00e5ff;
      }
      99% {
        clip-path: inset(0 0 100% 0);
        transform: translate(0);
        text-shadow: none;
      }
    }

    .about-glitch-footer {
      display: flex;
      gap: 20px;
      padding: 10px 20px;
      border-top: 1px solid var(--border);
      background: rgba(0,0,0,0.2);
    }

    .about-footer-tag {
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 0.15em;
      color: var(--text-dim);
    }

    .about-footer-tag.accent { color: var(--accent); }

    @media (max-width: 768px) {
      .about-section { padding: 0 20px 48px; }
      .about-glitch-line-nums { display: none; }
      .about-glitch-content { padding: 24px 20px; }
      .about-glitch-overlay { left: 20px; right: 20px; }
      .nav-author-tag { display: none; }
      .hero-byline { display: none; }
    }

    /* TOOLS SECTION */
    .tools-section {
      padding: 0 48px 100px;
      max-width: 1100px;
      margin: 0 auto;
      transition: transform 0.06s linear, opacity 0.06s linear;
      will-change: transform, opacity;
    }

    .section-label {
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--text-dim);
      margin-bottom: 40px;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .section-label::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    /* ── Diagonal cards ── */
    .tools-diag {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .tool-card {
      position: relative;
      overflow: hidden;
      cursor: pointer;
      height: 160px;
      border: 1px solid rgba(255,255,255,0.06);
      background: rgba(255,255,255,0.02);
      transition: height 0.35s cubic-bezier(0.4,0,0.2,1), background 0.3s,
                  transform 0.06s linear, opacity 0.06s linear;
      display: flex;
      align-items: stretch;
      will-change: transform, opacity;
    }
    .tool-card:hover { height: 210px; background: rgba(255,255,255,0.035); }

    /* alternating offset */
    .tool-card:nth-child(even) { margin-left: 72px; }
    .tool-card:nth-child(odd)  { margin-right: 72px; }

    /* diagonal clip on accent half */
    .diag-left {
      flex: 0 0 42%;
      padding: 28px 32px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      position: relative;
      z-index: 1;
      clip-path: polygon(0 0, 100% 0, 88% 100%, 0 100%);
      background: rgba(255,255,255,0.025);
      transition: background 0.3s;
    }
    .tool-card:hover .diag-left { background: rgba(255,255,255,0.04); }

    .diag-right {
      flex: 1;
      padding: 28px 28px 28px 44px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      position: relative;
      z-index: 1;
    }

    /* accent slash wash on hover */
    .tool-card::before {
      content: '';
      position: absolute;
      top: 0; bottom: 0; left: 0;
      width: 42%;
      background: var(--tc);
      opacity: 0;
      clip-path: polygon(0 0, 100% 0, 88% 100%, 0 100%);
      transition: opacity 0.3s;
      pointer-events: none;
      z-index: 0;
    }
    .tool-card:hover::before { opacity: 0.07; }

    /* no ::after needed — clearing old ghost */
    .tool-card::after { display: none; }

    .diag-num {
      font-family: var(--display);
      font-size: 64px;
      color: var(--tc);
      opacity: 0.18;
      line-height: 1;
      transition: opacity 0.2s;
    }
    .tool-card:hover .diag-num { opacity: 0.55; }

    .diag-icon { font-size: 22px; }

    .tool-name {
      font-family: var(--display);
      font-size: clamp(20px, 2.4vw, 30px);
      letter-spacing: 0.04em;
      color: var(--text-bright);
      line-height: 1.1;
      margin-bottom: 8px;
      transition: color 0.2s;
    }
    .tool-card:hover .tool-name { color: var(--tc); }

    .tool-desc {
      font-size: 13px;
      font-weight: 300;
      color: rgba(240,237,232,0.35);
      line-height: 1.65;
      max-width: 440px;
      transition: color 0.2s;
      margin-bottom: 0;
    }
    .tool-card:hover .tool-desc { color: rgba(240,237,232,0.62); }

    .diag-meta {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-top: 14px;
    }
    .tool-xp {
      font-family: var(--mono);
      font-size: 11px;
      color: var(--tc);
      opacity: 0.7;
      letter-spacing: 0.08em;
    }
    .diag-modes { display: flex; gap: 6px; }
    .tool-tag {
      font-family: var(--mono);
      font-size: 8px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 3px 9px;
      border: 1px solid var(--tc);
      color: var(--tc);
      opacity: 0.65;
      display: inline-block;
    }

    /* MODAL OVERLAY */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      z-index: 200;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      backdrop-filter: blur(4px);
    }

    .modal-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .modal {
      background: var(--surface);
      border: 1px solid var(--border-bright);
      width: 100%;
      max-width: 600px;
      padding: 48px;
      position: relative;
      transform: translateY(20px);
      transition: transform 0.3s;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-overlay.active .modal { transform: translateY(0); }

    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      color: var(--text-dim);
      font-size: 20px;
      cursor: pointer;
      transition: color 0.2s;
      font-family: var(--mono);
    }

    .modal-close:hover { color: var(--text-bright); }

    .modal-title {
      font-family: var(--display);
      font-size: 36px;
      color: var(--text-bright);
      margin-bottom: 8px;
      letter-spacing: 0.03em;
    }

    .modal-sub {
      font-size: 13px;
      color: var(--text-dim);
      font-family: var(--mono);
      margin-bottom: 32px;
      letter-spacing: 0.05em;
    }

    /* Form fields */
    .field { margin-bottom: 20px; }

    .field label {
      display: block;
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-dim);
      margin-bottom: 8px;
    }

    .field input, .field select {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border-bright);
      color: var(--text-bright);
      font-family: var(--mono);
      font-size: 14px;
      padding: 12px 16px;
      outline: none;
      transition: border-color 0.2s;
      appearance: none;
    }

    .field input:focus, .field select:focus {
      border-color: var(--accent);
    }

    .field input::placeholder { color: var(--text-dim); }

    input:-webkit-autofill,
    input:-webkit-autofill:hover,
    input:-webkit-autofill:focus,
    input:-webkit-autofill:active,
    select:-webkit-autofill,
    textarea:-webkit-autofill {
      -webkit-box-shadow: 0 0 0 1000px #0a0a0a inset !important;
      -webkit-text-fill-color: #f0f0f0 !important;
      caret-color: #f0f0f0 !important;
      border-color: #2e2e2e !important;
      transition: background-color 99999s ease-in-out 0s;
    }

    .fields-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .submit-btn {
      width: 100%;
      background: var(--accent);
      color: #fff;
      border: none;
      font-family: var(--display);
      font-size: 20px;
      letter-spacing: 0.1em;
      padding: 16px;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s;
      margin-top: 8px;
    }

    .submit-btn:hover { background: #ff6620; }
    .submit-btn:active { transform: scale(0.99); }
    .submit-btn:disabled { background: var(--border-bright); cursor: not-allowed; }

    /* Result box */
    .result-box {
      margin-top: 24px;
      background: var(--bg);
      border: 1px solid var(--border-bright);
      border-left: 3px solid var(--accent);
      padding: 20px 24px;
      font-size: 14px;
      line-height: 1.8;
      color: var(--text-bright);
      display: none;
      animation: fadeUp 0.3s ease both;
    }

    .result-box.visible { display: block; }

    .result-label {
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 10px;
    }

    .xp-toast {
      margin-top: 12px;
      font-family: var(--mono);
      font-size: 11px;
      color: var(--accent2);
      letter-spacing: 0.1em;
    }

    /* Modal color accents */
    .modal-roaster { border-top: 2px solid var(--roaster); }
    .modal-roaster .modal-sub { color: var(--roaster); }
    .modal-roaster .submit-btn { background: var(--roaster); }
    .modal-roaster .submit-btn:hover { background: #0066a0; }
    .modal-roaster .verdict-panel { border-left-color: var(--roaster); }
    .modal-roaster .result-label { color: var(--roaster); }
    .modal-roaster .verdict-placeholder { color: var(--roaster); }
    .modal-roaster .xp-toast { color: var(--roaster); }

    .modal-idea { border-top: 2px solid var(--idea); }
    .modal-idea .modal-sub { color: var(--idea); }
    .modal-idea .submit-btn { background: var(--idea); }
    .modal-idea .submit-btn:hover { background: #ff8e8e; }
    .modal-idea .verdict-panel { border-left-color: var(--idea); }
    .modal-idea .result-label { color: var(--idea); }
    .modal-idea .verdict-placeholder { color: var(--idea); }
    .modal-idea .xp-toast { color: var(--idea); }

    .modal-stack { border-top: 2px solid var(--stack); }
    .modal-stack .modal-sub { color: var(--stack); }
    .modal-stack .submit-btn { background: var(--stack); color: #000; }
    .modal-stack .submit-btn:hover { background: #33ffaa; }
    .modal-stack .verdict-panel { border-left-color: var(--stack); }
    .modal-stack .result-label { color: var(--stack); }
    .modal-stack .verdict-placeholder { color: var(--stack); }
    .modal-stack .xp-toast { color: var(--stack); }

    .modal-resume { border-top: 2px solid var(--resume); }
    .modal-resume .modal-sub { color: var(--resume); }
    .modal-resume .submit-btn { background: var(--resume); }
    .modal-resume .submit-btn:hover { background: #c084fc; }
    .modal-resume .verdict-panel { border-left-color: var(--resume); }
    .modal-resume .result-label { color: var(--resume); }
    .modal-resume .verdict-placeholder { color: var(--resume); }
    .modal-resume .xp-toast { color: var(--resume); }

    /* Mode toggle */
    .mode-toggle {
      display: flex;
      gap: 0;
      margin-bottom: 20px;
      border: 1px solid var(--border-bright);
      width: fit-content;
    }
    .mode-btn {
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      padding: 10px 20px;
      background: none;
      border: none;
      color: var(--text-dim);
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    .mode-btn.active { background: var(--resume); color: #fff; }
    .mode-btn:not(.active):hover { background: var(--border); color: var(--text-bright); }

    /* CHECK / CREATE main tab switcher */
    .tool-tabs {
      display: flex;
      margin-bottom: 24px;
      border-bottom: 1px solid var(--border-bright);
    }
    .tool-tab {
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      padding: 10px 22px;
      background: none;
      border: none;
      border-bottom: 2px solid transparent;
      color: var(--text-dim);
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: -1px;
    }
    .tool-tab:hover { color: var(--text); }
    .tool-tab.active { color: var(--text-bright); border-bottom-color: currentColor; }
    .modal-roaster .tool-tab.active { color: #0077b5; border-bottom-color: #0077b5; }
    .modal-idea    .tool-tab.active { color: #ff6b6b; border-bottom-color: #ff6b6b; }
    .modal-stack   .tool-tab.active { color: var(--accent2); border-bottom-color: var(--accent2); }
    .modal-resume  .tool-tab.active { color: var(--resume); border-bottom-color: var(--resume); }

    /* created output panel */
    .created-panel {
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border-bright);
      border-left: 3px solid var(--accent2);
      padding: 20px;
      font-family: var(--mono);
      font-size: 12px;
      line-height: 1.8;
      color: var(--text);
      white-space: pre-wrap;
    }
    .modal-roaster .created-panel { border-left-color: #0077b5; }
    .modal-idea    .created-panel { border-left-color: #ff6b6b; }
    .modal-stack   .created-panel { border-left-color: var(--accent2); }
    .modal-resume  .created-panel { border-left-color: var(--resume); }

    /* Input mode panels */
    .input-mode { display: none; }
    .input-mode.active { display: block; }

    /* Textarea field */
    .field textarea {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border-bright);
      color: var(--text-bright);
      font-family: var(--mono);
      font-size: 13px;
      padding: 12px 16px;
      outline: none;
      transition: border-color 0.2s;
      resize: vertical;
      min-height: 150px;
      line-height: 1.6;
    }
    .field textarea:focus { border-color: var(--resume); }
    .field textarea::placeholder { color: var(--text-dim); }

    /* Split verdict panel for resume */
    .verdict-split {
      display: flex;
      flex-direction: column;
    }
    .verdict-half {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
    }
    .verdict-half:last-child { border-bottom: none; }
    .verdict-half.roast-half {
      border-left: 3px solid var(--resume);
      background: rgba(168, 85, 247, 0.04);
    }
    .verdict-half.fix-half {
      border-left: 3px solid var(--stack);
      background: rgba(0, 230, 118, 0.04);
    }
    .verdict-half-label {
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      margin-bottom: 10px;
    }
    .verdict-half-label.roast-label { color: var(--resume); }
    .verdict-half-label.fix-label { color: var(--stack); }
    .verdict-half-text {
      font-size: 13px;
      line-height: 1.8;
      color: var(--text-bright);
      white-space: pre-wrap;
    }

    /* Two column modal */
    .modal-wide {
      max-width: 900px !important;
    }

    .modal-columns {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
      margin-top: 8px;
    }

    .modal-left {
      display: flex;
      flex-direction: column;
    }

    .modal-right {
      display: flex;
      flex-direction: column;
    }

    .verdict-panel {
      background: var(--bg);
      border: 1px solid var(--border-bright);
      border-left: 3px solid var(--accent);
      min-height: 300px;
      display: flex;
      flex-direction: column;
      padding: 24px;
    }

    .verdict-waiting {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 260px;
      gap: 12px;
      opacity: 0.3;
    }

    .verdict-icon {
      font-size: 32px;
      animation: pulse 2s ease infinite;
    }

    .verdict-placeholder {
      font-family: var(--mono);
      font-size: 13px;
      color: var(--accent);
      letter-spacing: 0.1em;
    }

    .verdict-hint {
      font-family: var(--mono);
      font-size: 11px;
      color: var(--text-dim);
      text-align: center;
      letter-spacing: 0.05em;
    }

    .verdict-result {
      overflow-y: visible;
    }

    .verdict-result #roaster-text {
      font-size: 14px;
      line-height: 1.8;
      color: var(--text-bright);
      margin-top: 8px;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.3; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(1.1); }
    }

    /* Loading spinner */
    .spinner {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      margin-right: 8px;
      vertical-align: middle;
    }

    /* Animations */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(16px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: var(--border-bright); }

    /* Scroll blur overlay — fades content as it exits top */
    .scroll-fade {
      pointer-events: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 220px;
      background: linear-gradient(
        to bottom,
        rgba(10,10,10,0.98) 0%,
        rgba(10,10,10,0.7) 40%,
        rgba(10,10,10,0) 100%
      );
      z-index: 98;
    }

    /* Rank Progression Modal */
    .rank-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      z-index: 200;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      backdrop-filter: blur(4px);
    }
    .rank-modal-overlay.active {
      opacity: 1;
      pointer-events: all;
    }
    .rank-modal {
      background: var(--surface);
      border: 1px solid var(--border-bright);
      width: 100%;
      max-width: 480px;
      padding: 40px;
      position: relative;
      transform: translateY(20px);
      transition: transform 0.3s;
      max-height: 88vh;
      overflow-y: auto;
    }
    .rank-modal-overlay.active .rank-modal { transform: translateY(0); }

    .rank-modal-title {
      font-family: var(--display);
      font-size: 28px;
      letter-spacing: 0.08em;
      color: var(--text-bright);
      margin-bottom: 4px;
    }
    .rank-modal-sub {
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 0.2em;
      color: var(--text-dim);
      text-transform: uppercase;
      margin-bottom: 32px;
    }
    .rank-list { display: flex; flex-direction: column; gap: 0; }

    .rank-row {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 14px 0;
      border-bottom: 1px solid var(--border);
      position: relative;
      cursor: default;
      transition: background 0.2s;
    }
    .rank-row:last-child { border-bottom: none; }

    .rank-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
      border: 2px solid var(--border-bright);
      background: transparent;
      transition: all 0.2s;
    }
    .rank-row.completed .rank-indicator {
      background: var(--accent);
      border-color: var(--accent);
    }
    .rank-row.current .rank-indicator {
      background: var(--accent2);
      border-color: var(--accent2);
      box-shadow: 0 0 8px rgba(255,204,0,0.6);
    }

    .rank-connector {
      position: absolute;
      left: 4px;
      top: 28px;
      width: 2px;
      height: calc(100% - 14px);
      background: var(--border);
    }
    .rank-row.completed .rank-connector { background: var(--accent); }
    .rank-row:last-child .rank-connector { display: none; }

    .rank-info { flex: 1; }
    .rank-name {
      font-family: var(--display);
      font-size: 18px;
      letter-spacing: 0.08em;
      color: var(--text-dim);
    }
    .rank-row.completed .rank-name { color: var(--text-bright); }
    .rank-row.current .rank-name { color: var(--accent2); }

    .rank-xp-range {
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 0.1em;
      color: var(--text-dim);
      margin-top: 2px;
    }
    .rank-unlock {
      font-family: var(--mono);
      font-size: 10px;
      color: #555;
      margin-top: 4px;
    }
    .rank-row.completed .rank-unlock,
    .rank-row.current .rank-unlock { color: var(--accent); }

    .rank-you-are-here {
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--accent2);
      background: rgba(255,204,0,0.08);
      border: 1px solid rgba(255,204,0,0.2);
      padding: 3px 8px;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .rank-progress-mini {
      margin-top: 6px;
      height: 3px;
      background: var(--border);
      border-radius: 2px;
      overflow: hidden;
      width: 120px;
    }
    .rank-progress-mini-fill {
      height: 100%;
      background: var(--accent2);
      border-radius: 2px;
      transition: width 0.5s ease;
    }

    /* Make HUD level and XP block clickable */
    .hud-block.hud-level,
    .hud-xp-block {
      cursor: pointer;
    }
    .hud-block.hud-level:hover .hud-value,
    .hud-xp-block:hover .hud-xp-label {
      color: var(--accent2);
      transition: color 0.2s;
    }

    /* Share button */
    .share-btn {
      margin-top: 14px;
      background: none;
      border: 1px solid var(--border-bright);
      color: var(--text-dim);
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      padding: 8px 16px;
      cursor: pointer;
      transition: all 0.2s;
      display: none;
    }
    .share-btn:hover { border-color: var(--accent); color: var(--accent); }
    .share-btn.visible { display: inline-block; }

    /* Share overlay */
    .share-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.88);
      z-index: 300;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      backdrop-filter: blur(6px);
    }
    .share-overlay.active { opacity: 1; pointer-events: all; }

    .share-panel {
      background: var(--surface);
      border: 1px solid var(--border-bright);
      width: 100%;
      max-width: 820px;
      padding: 32px;
      display: flex;
      gap: 32px;
      position: relative;
      animation: fadeUp 0.3s ease both;
    }

    .share-close {
      position: absolute;
      top: 16px; right: 16px;
      background: none;
      border: none;
      color: var(--text-dim);
      font-size: 18px;
      cursor: pointer;
      font-family: var(--mono);
      transition: color 0.2s;
    }
    .share-close:hover { color: var(--text-bright); }

    .share-controls {
      display: flex;
      flex-direction: column;
      gap: 24px;
      min-width: 190px;
    }

    .share-control-group { display: flex; flex-direction: column; gap: 10px; }

    .share-control-label {
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--text-dim);
    }

    .share-switcher { display: flex; flex-direction: column; gap: 6px; }

    .share-switch-btn {
      background: var(--bg);
      border: 1px solid var(--border-bright);
      color: var(--text-dim);
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing: 0.1em;
      padding: 10px 14px;
      cursor: pointer;
      text-align: left;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .share-switch-btn:hover { border-color: var(--accent); color: var(--text); }
    .share-switch-btn.active { border-color: var(--accent); color: var(--text-bright); background: rgba(255,77,0,0.08); }
    .share-switch-btn .sdot { width: 6px; height: 6px; border-radius: 50%; background: var(--border-bright); flex-shrink: 0; transition: background 0.2s; }
    .share-switch-btn.active .sdot { background: var(--accent); box-shadow: 0 0 8px rgba(255,77,0,0.6); }

    .share-ratio-switcher { display: flex; gap: 6px; }

    .share-ratio-btn {
      background: var(--bg);
      border: 1px solid var(--border-bright);
      color: var(--text-dim);
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 0.08em;
      padding: 8px 10px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      flex: 1;
    }
    .share-ratio-btn:hover { border-color: var(--accent); color: var(--text); }
    .share-ratio-btn.active { border-color: var(--accent); color: var(--text-bright); background: rgba(255,77,0,0.08); }
    .share-ratio-icon { border: 1.5px solid currentColor; opacity: 0.6; }
    .ratio-label { font-size: 11px; letter-spacing: 0.08em; }
    .ratio-hint { font-family: var(--mono); font-size: 8px; letter-spacing: 0.08em; color: var(--text-dim); margin-top: 1px; }
    .share-ratio-btn.active .ratio-hint { color: rgba(255,77,0,0.7); }
    .share-ratio-icon.sq { width: 18px; height: 18px; }
    .share-ratio-icon.pt { width: 14px; height: 18px; }
    .share-ratio-icon.st { width: 10px; height: 18px; }

    .share-download-btn {
      background: var(--accent);
      border: none;
      color: #fff;
      font-family: var(--display);
      font-size: 18px;
      letter-spacing: 0.1em;
      padding: 14px;
      cursor: pointer;
      transition: background 0.15s;
      margin-top: auto;
    }
    .share-download-btn:hover { background: #ff6620; }

    .share-divider { width: 1px; background: var(--border); flex-shrink: 0; }

    .share-preview-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .share-preview-label {
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--text-dim);
      align-self: flex-start;
    }

    .share-canvas-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 1;
      width: 100%;
    }

    canvas#shareCard {
      max-width: 100%;
      max-height: 400px;
      box-shadow: 0 0 40px rgba(0,0,0,0.6);
    }
  
    /* ── MOBILE RESPONSIVE ── */
    @media (max-width: 768px) {

      /* Nav */
      nav {
        padding: 0 16px;
        height: 52px;
      }
      .nav-logo { flex-direction: row; align-items: center; gap: 8px; }
      .nav-logo-tagline { display: none; }
      .nav-sparks { height: 10px; margin-bottom: 0; }
      .nav-links { display: none; }
      .nav-username { display: none; }
      .nav-login-btn { font-size: 9px; padding: 5px 10px; }

      /* HUD — horizontal scroll */
      .hud {
        padding: 0;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        top: 52px;
      }
      .hud::-webkit-scrollbar { display: none; }
      .hud-block {
        padding: 10px 16px;
        min-width: 110px;
        flex-shrink: 0;
      }
      .hud-xp-block {
        padding: 10px 16px;
        min-width: 160px;
        flex-shrink: 0;
      }
      .hud-label { font-size: 8px; }
      .hud-value { font-size: 16px; }

      /* Hero — single column, no split */
      .hero { padding: 40px 16px 32px; }
      .hero-split {
        grid-template-columns: 1fr;
        gap: 24px;
      }
      .hero-left { align-items: flex-start; }
      .hero-right { padding-top: 0; }
      .hero h1 { font-size: clamp(56px, 16vw, 90px); }
      .hero-sub {
        font-size: 13px;
        text-align: left;
        align-self: flex-start;
        max-width: 100%;
      }
      .hero-stats { align-self: flex-start; overflow-x: auto; }
      .stat { min-width: 100px; padding: 14px 16px; }
      .stat-num { font-size: 28px; }

      /* Todo panel */
      .todo-panel { max-height: 280px; }
      .todo-list { max-height: 160px; }

      /* Tools section — DISABLE scroll animation on mobile, always visible */
      .tools-section {
        opacity: 1 !important;
        transform: none !important;
        padding: 0 16px 60px;
      }

      /* Diagonal — flatten on mobile */
      .tool-card {
        opacity: 1 !important;
        transform: none !important;
        height: auto !important;
        flex-direction: column;
        margin-left: 0 !important;
        margin-right: 0 !important;
      }
      .diag-left {
        clip-path: none;
        flex: none;
        padding: 20px 20px 12px;
        flex-direction: row;
        align-items: center;
        gap: 14px;
      }
      .diag-num { font-size: 40px; }
      .diag-right { padding: 12px 20px 22px; }
      .tool-name { font-size: 20px; }
      .tool-card::before { clip-path: none; width: 100%; height: 3px; bottom: auto; }

      /* Section label */
      .section-label { font-size: 9px; margin-bottom: 24px; }

      /* Modal — slide up from bottom */
      .modal-overlay { padding: 0; align-items: flex-end; }
      .modal {
        max-width: 100%;
        width: 100%;
        padding: 24px 16px;
        max-height: 90vh;
        overflow-y: auto;
        border-radius: 0;
        border-left: none;
        border-right: none;
        border-bottom: none;
      }
      .modal-wide { max-width: 100% !important; }
      .modal-title { font-size: 26px; }
      .modal-columns { grid-template-columns: 1fr; gap: 20px; }
      .fields-row { grid-template-columns: 1fr; gap: 12px; }
      .verdict-panel { min-height: 200px; }

      /* Share panel */
      .share-overlay { padding: 0; align-items: flex-end; }
      .share-panel {
        flex-direction: column;
        padding: 20px 16px;
        gap: 20px;
        max-height: 90vh;
        overflow-y: auto;
        border-radius: 0;
        border-left: none;
        border-right: none;
        border-bottom: none;
      }
      .share-divider { width: 100%; height: 1px; }
      .share-controls { min-width: unset; }
      .share-ratio-switcher { justify-content: flex-start; }
      canvas#shareCard { max-height: 260px; }

      /* Resume split */
      .verdict-split { flex-direction: column !important; }

      /* Banners */
      .levelup-banner, .unlock-banner {
        width: 90%;
        padding: 24px 20px;
      }
    }

    /* Extra small */
    @media (max-width: 400px) {
      .hero h1 { font-size: 52px; }
      .tool-card { height: auto !important; }
      .modal { padding: 20px 14px; }
    }
    /* LEADERBOARD MODAL */
    .lb-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.88);
      z-index: 300;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      backdrop-filter: blur(6px);
    }
    .lb-overlay.active { opacity: 1; pointer-events: all; }
    .lb-modal {
      background: var(--surface);
      border: 1px solid var(--border-bright);
      width: 100%;
      max-width: 620px;
      position: relative;
      transform: translateY(24px);
      transition: transform 0.3s;
      max-height: 88vh;
      display: flex;
      flex-direction: column;
    }
    .lb-overlay.active .lb-modal { transform: translateY(0); }
    .lb-header { padding: 28px 32px 0; border-bottom: 1px solid var(--border); }
    .lb-title { font-family: var(--display); font-size: 32px; letter-spacing: 0.08em; color: var(--text-bright); margin-bottom: 4px; }
    .lb-sub { font-family: var(--mono); font-size: 9px; letter-spacing: 0.2em; color: var(--text-dim); text-transform: uppercase; margin-bottom: 20px; }
    .lb-close { position: absolute; top: 20px; right: 20px; background: none; border: none; color: var(--text-dim); font-size: 18px; cursor: pointer; transition: color 0.2s; }
    .lb-close:hover { color: var(--text-bright); }
    .lb-tabs { display: flex; border-bottom: 1px solid var(--border); }
    .lb-tab { flex: 1; background: none; border: none; border-bottom: 2px solid transparent; color: var(--text-dim); font-family: var(--mono); font-size: 9px; letter-spacing: 0.15em; padding: 14px 16px; cursor: pointer; transition: all 0.2s; text-transform: uppercase; }
    .lb-tab:hover { color: var(--text); }
    .lb-tab.active { color: var(--accent2); border-bottom-color: var(--accent2); }
    .lb-body { flex: 1; overflow-y: auto; }
    .lb-section { display: none; }
    .lb-section.active { display: block; }
    .lb-row { display: flex; align-items: center; gap: 14px; padding: 14px 32px; border-bottom: 1px solid var(--border); transition: background 0.15s; }
    .lb-row:hover { background: rgba(255,255,255,0.02); }
    .lb-row.top-1 { border-left: 3px solid #FFD700; }
    .lb-row.top-2 { border-left: 3px solid #C0C0C0; }
    .lb-row.top-3 { border-left: 3px solid #CD7F32; }
    .lb-rank { font-family: var(--display); font-size: 20px; color: var(--text-dim); width: 32px; text-align: center; flex-shrink: 0; }
    .lb-row.top-1 .lb-rank { color: #FFD700; }
    .lb-row.top-2 .lb-rank { color: #C0C0C0; }
    .lb-row.top-3 .lb-rank { color: #CD7F32; }
    .lb-avatar { width: 34px; height: 34px; border-radius: 50%; object-fit: cover; border: 1px solid var(--border-bright); flex-shrink: 0; background: var(--border); }
    .lb-avatar-placeholder { width: 34px; height: 34px; border-radius: 50%; background: var(--border); border: 1px solid var(--border-bright); flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 14px; }
    .lb-info { flex: 1; min-width: 0; }
    .lb-name { font-family: var(--mono); font-size: 12px; color: var(--text-bright); letter-spacing: 0.05em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .lb-level { font-family: var(--mono); font-size: 9px; color: var(--text-dim); letter-spacing: 0.1em; margin-top: 2px; }
    .lb-xp { font-family: var(--display); font-size: 20px; color: var(--accent); letter-spacing: 0.05em; flex-shrink: 0; }
    .lb-xp-label { font-family: var(--mono); font-size: 8px; color: var(--text-dim); letter-spacing: 0.1em; text-align: right; }
    .lb-empty { padding: 48px 32px; text-align: center; font-family: var(--mono); font-size: 11px; color: var(--text-dim); letter-spacing: 0.1em; }
    .lb-loading { padding: 48px 32px; text-align: center; font-family: var(--mono); font-size: 11px; color: var(--text-dim); letter-spacing: 0.1em; animation: pulse 1.5s ease-in-out infinite; }
    .lb-personal-wrap { padding: 28px 32px; }
    .lb-personal-card { display: flex; align-items: center; gap: 20px; padding: 20px; border: 1px solid var(--border-bright); background: rgba(255,77,0,0.04); border-left: 3px solid var(--accent); margin-bottom: 24px; }
    .lb-personal-avatar { width: 52px; height: 52px; border-radius: 50%; border: 2px solid var(--accent); object-fit: cover; flex-shrink: 0; }
    .lb-personal-name { font-family: var(--display); font-size: 24px; color: var(--text-bright); letter-spacing: 0.05em; }
    .lb-personal-rank { font-family: var(--mono); font-size: 10px; color: var(--accent); letter-spacing: 0.15em; margin-top: 4px; }
    .lb-personal-stats { display: grid; grid-template-columns: repeat(3,1fr); gap: 2px; margin-bottom: 24px; }
    .lb-stat-box { background: var(--bg); border: 1px solid var(--border); padding: 16px; text-align: center; }
    .lb-stat-num { font-family: var(--display); font-size: 28px; line-height: 1; color: var(--text-bright); margin-bottom: 6px; }
    .lb-stat-label { font-family: var(--mono); font-size: 8px; letter-spacing: 0.15em; color: var(--text-dim); text-transform: uppercase; }
    .lb-achievements-title { font-family: var(--mono); font-size: 9px; letter-spacing: 0.2em; color: var(--text-dim); text-transform: uppercase; margin-bottom: 12px; }
    .lb-achievements-grid { display: grid; grid-template-columns: repeat(2,1fr); gap: 8px; }
    .lb-achievement { display: flex; align-items: center; gap: 10px; padding: 10px 14px; border: 1px solid var(--border); background: var(--bg); font-family: var(--mono); font-size: 11px; color: var(--text); }
    .lb-achievement.locked { opacity: 0.35; filter: grayscale(1); }
    .lb-achievement-icon { font-size: 16px; flex-shrink: 0; }
    .lb-guest-msg { padding: 48px 32px; text-align: center; }
    .lb-guest-msg p { font-family: var(--mono); font-size: 12px; color: var(--text-dim); letter-spacing: 0.08em; margin-bottom: 20px; }
    .lb-signin-btn { font-family: var(--mono); font-size: 11px; letter-spacing: 0.15em; padding: 12px 28px; background: var(--accent); border: none; color: #fff; cursor: pointer; transition: background 0.2s; }
    .lb-signin-btn:hover { background: #ff6620; }
    @media (max-width: 768px) {
      .lb-overlay { padding: 0; align-items: flex-end; }
      .lb-modal { max-width: 100%; max-height: 92vh; }
      .lb-row { padding: 12px 20px; }
      .lb-personal-wrap { padding: 20px; }
      .lb-achievements-grid { grid-template-columns: 1fr; }
    }

    /* FOOTER */
    .site-footer {
      border-top: 1px solid var(--border);
      padding: 20px 48px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-family: var(--mono);
      font-size: 10px;
      color: var(--text-dim);
      letter-spacing: 0.1em;
    }
    .footer-dot { color: var(--border-bright); }
    .footer-tagline { color: var(--accent); }
    @media (max-width: 768px) {
      .site-footer { padding: 16px 20px; flex-wrap: wrap; gap: 8px; }
    }
  
    /* ── QUESTIONNAIRE STEPS ── */
    .q-steps { display: flex; gap: 6px; margin-bottom: 18px; }
    .q-step-dot { flex: 1; height: 3px; background: var(--border); border-radius: 2px; transition: background 0.3s; }
    .q-step-dot.active { background: var(--accent2); }
    .q-step-dot.done { background: var(--accent); }
    .q-step-label { font-family: var(--mono); font-size: 10px; color: var(--text-dim); letter-spacing: 0.1em; margin-bottom: 14px; }
    .q-panel { display: none; flex-direction: column; gap: 14px; }
    .q-panel.active { display: flex; }
    .q-nav { display: flex; gap: 10px; margin-top: 6px; }
    .q-btn-next { flex: 1; padding: 10px 0; background: var(--accent2); color: #000; font-family: var(--display); font-size: 14px; letter-spacing: 0.1em; border: none; cursor: pointer; border-radius: 2px; transition: opacity 0.2s; }
    .q-btn-next:hover { opacity: 0.85; }
    .q-btn-back { padding: 10px 18px; background: transparent; color: var(--text-dim); font-family: var(--display); font-size: 14px; letter-spacing: 0.1em; border: 1px solid var(--border); cursor: pointer; border-radius: 2px; transition: all 0.2s; }
    .q-btn-back:hover { border-color: var(--text-dim); color: var(--text); }
    .q-chips { display: flex; flex-wrap: wrap; gap: 8px; }
    .q-chip { padding: 6px 14px; border: 1px solid var(--border); background: transparent; color: var(--text-dim); font-family: var(--mono); font-size: 11px; cursor: pointer; border-radius: 2px; transition: all 0.15s; user-select: none; }
    .q-chip.selected { border-color: var(--accent2); color: var(--accent2); background: rgba(0,230,118,0.06); }
</style>
</head>
<body>


  <!-- Scroll blur overlay -->
  <div class="scroll-fade"></div>

  <!-- NAV -->
  <nav>
    <button class="hamburger" id="hamburger" onclick="toggleDrawer()">
      <span></span><span></span><span></span>
    </button>
    <div class="nav-logo">
      <div class="nav-sparks"><span></span><span></span><span></span><span></span><span></span></div>
      <div class="nav-logo-name">ANVIL</div>
      <span class="nav-logo-tagline">Forged in Satire</span>
      <span class="nav-author-tag">by Pushkar Gupta</span>
    </div>
    <ul class="nav-links">
      <li><a href="#" onclick="navScrollTo('tools'); return false;">Tools</a></li>
      <li><a href="#" onclick="openLeaderboard(); return false;">Leaderboard</a></li>
      <li><a href="#" onclick="navScrollTo('about'); return false;">About</a></li>
    </ul>
    <div class="nav-auth" id="nav-auth">
      <a href="/auth/login" class="nav-login-btn" id="nav-login-btn">⬡ SIGN IN</a>
      <div class="nav-user" id="nav-user" style="display:none;">
        <img class="nav-avatar" id="nav-avatar" src="" alt="avatar"/>
        <span class="nav-username" id="nav-username"></span>
        <button class="nav-logout-btn" onclick="confirmLogout()">
          <span class="logout-arrow">↩</span>
          <span class="logout-label">SIGN OUT</span>
        </button>
      </div>
    </div>
  </nav>

  <!-- HUD -->
  <div class="hud">
    <div class="hud-block hud-level" onclick="openRankModal()">
      <div class="hud-label">Rank</div>
      <div class="hud-value" id="levelLabel">LVL 1</div>
    </div>
    <div class="hud-block hud-streak">
      <div class="hud-label">Streak</div>
      <div class="hud-value"><span id="hudStreak">0</span><span class="hud-streak-fire" id="streakFire">🔥</span></div>
    </div>
    <div class="hud-block hud-uses">
      <div class="hud-label">Tools Used</div>
      <div class="hud-value" id="hudUses">0</div>
    </div>
    <div class="hud-block hud-xp">
      <div class="hud-label">Total XP</div>
      <div class="hud-value" id="hudXP">0</div>
    </div>
    <div class="hud-xp-block" onclick="openRankModal()">
      <div class="hud-xp-top">
        <span class="hud-xp-label">Progress to next level</span>
        <span class="hud-xp-points" id="xpPoints">0 / 150 XP</span>
      </div>
      <div class="hud-xp-track">
        <div class="hud-xp-fill" id="xpFill"></div>
      </div>
    </div>
  </div>

  <!-- Rank Progression Modal -->
  <div class="rank-modal-overlay" id="rankModal" onclick="if(event.target===this)closeRankModal()">
    <div class="rank-modal">
      <button class="modal-close" onclick="closeRankModal()">✕</button>
      <div class="rank-modal-title">RANK PROGRESSION</div>
      <div class="rank-modal-sub">// your path to sovereignty</div>
      <div class="rank-list" id="rankList"></div>
    </div>
  </div>

  <!-- Level Up Banner -->
  <div class="levelup-banner" id="levelupBanner">
    <div class="levelup-title">⚡ LEVEL UP!</div>
    <div class="levelup-sub" id="levelupSub">// you are now an INTERN</div>
  </div>

  <div class="unlock-banner" id="unlockBanner">
    <div class="unlock-title">🔓 UNLOCKED!</div>
    <div class="unlock-sub" id="unlockSub">// Ravi Gupta is now available</div>
  </div>

  <!-- HERO -->
  <section class="hero">
    <canvas id="fire-canvas"></canvas>
    <div class="hero-split">
      <!-- Left: Hero content -->
      <div class="hero-left">
        <div class="hero-eyebrow">Built different. Roasted fresh.</div>
        <div class="hero-heading-block">
          <div class="hero-sparks"><span></span><span></span><span></span><span></span><span></span></div>
          <h1>ANVIL</h1>
          <div class="hero-tagline-row">
            <span class="hero-tagline">Forged in Satire</span>
            <span class="hero-byline">· by Pushkar Gupta</span>
          </div>
        </div>
        <p class="hero-sub">AI-powered tools that are actually useful — wrapped in enough sass to make you question your life choices.</p>
        <div class="hero-stats">
          <div class="stat stat-uses">
            <span class="stat-num" id="statUses">0</span>
            <span class="stat-label">Tools Used</span>
          </div>
          <div class="stat stat-streak">
            <span class="stat-num"><span id="statStreak">0</span><span class="fire-animated">🔥</span></span>
            <span class="stat-label">Day Streak</span>
          </div>
          <div class="stat stat-xp">
            <span class="stat-num" id="statXP">0</span>
            <span class="stat-label">Total XP</span>
          </div>
        </div>
      </div>

      <!-- Right: To-do list -->
      <div class="hero-right">
        <div class="todo-panel">
          <div class="todo-header">
            <div class="todo-tabs">
              <button class="todo-tab active" id="tab-personal" onclick="switchTodoTab('personal')">// MY TASKS</button>
              <button class="todo-tab" id="tab-roadmap" onclick="switchTodoTab('roadmap')">// ANVIL ROADMAP</button>
            </div>
          </div>

          <!-- Personal tasks -->
          <div class="todo-section active" id="todo-personal">
            <div class="todo-add">
              <input type="text" id="todo-input" placeholder="add a task..." onkeydown="if(event.key==='Enter') addTodo()"/>
              <button class="todo-add-btn" onclick="addTodo()">+</button>
            </div>
            <ul class="todo-list" id="todo-list"></ul>
            <div class="todo-empty" id="todo-empty">// no tasks yet. add one above.</div>
          </div>

          <!-- Anvil roadmap -->
          <div class="todo-section" id="todo-roadmap">
            <ul class="todo-list roadmap-list">
              <li class="todo-item roadmap-item done"><span class="todo-check">✓</span><span class="todo-text">4 AI tools live</span></li>
              <li class="todo-item roadmap-item done"><span class="todo-check">✓</span><span class="todo-text">Gamification system</span></li>
              <li class="todo-item roadmap-item done"><span class="todo-check">✓</span><span class="todo-text">Shareable result cards</span></li>
              <li class="todo-item roadmap-item done"><span class="todo-check">✓</span><span class="todo-text">Unlockable comic styles</span></li>
              <li class="todo-item roadmap-item done"><span class="todo-check">✓</span><span class="todo-text">Mobile responsive</span></li>
              <li class="todo-item roadmap-item"><span class="todo-check">○</span><span class="todo-text">Login + leaderboard</span></li>
              <li class="todo-item roadmap-item"><span class="todo-check">○</span><span class="todo-text">Hinglish mode</span></li>
              <li class="todo-item roadmap-item"><span class="todo-check">○</span><span class="todo-text">Rewards & crates</span></li>
              <li class="todo-item roadmap-item"><span class="todo-check">○</span><span class="todo-text">More tools</span></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ABOUT -->
  <section class="about-section" id="about">
    <div class="about-glitch-wrap">
      <div class="about-glitch-header">
        <span class="about-glitch-tag">// WHO_BUILT_THIS.exe</span>
        <span class="about-glitch-status"><span class="about-status-dot"></span>RUNNING</span>
      </div>
      <div class="about-glitch-body">
        <div class="about-glitch-line-nums">
          <span>01</span><span>02</span><span>03</span><span>04</span><span>05</span>
          <span>06</span><span>07</span><span>08</span><span>09</span><span>10</span>
        </div>
        <div class="about-glitch-content">
          <p class="about-glitch-text" id="aboutGlitchText">I'm Pushkar Gupta. ANVIL wasn't supposed to be this. It started as a fun side project — something to mess around with after a previous one that, honestly, flopped. I've always been the kind of person who makes people laugh, and I've loved comedy and comics for as long as I can remember. So somewhere between the disappointment of that last build and a bunch of random inspiration hitting at once, ANVIL happened. No grand vision, no master plan — just one thing leading to another. The idea was probably sitting in my head all along, waiting. What came out is this: a little pocket of unseriousness in a world that takes itself way too seriously. Here's to making it better. Cheers.</p>
          <div class="about-glitch-overlay" aria-hidden="true">I'm Pushkar Gupta. ANVIL wasn't supposed to be this. It started as a fun side project — something to mess around with after a previous one that, honestly, flopped. I've always been the kind of person who makes people laugh, and I've loved comedy and comics for as long as I can remember. So somewhere between the disappointment of that last build and a bunch of random inspiration hitting at once, ANVIL happened. No grand vision, no master plan — just one thing leading to another. The idea was probably sitting in my head all along, waiting. What came out is this: a little pocket of unseriousness in a world that takes itself way too seriously. Here's to making it better. Cheers.</div>
        </div>
      </div>
      <div class="about-glitch-footer">
        <span class="about-footer-tag">EXIT_CODE: 0</span>
        <span class="about-footer-tag">LINES: 10</span>
        <span class="about-footer-tag accent">STATUS: UNSERIOUS</span>
      </div>
    </div>
  </section>

  <!-- TOOLS -->
  <section class="tools-section" id="tools">
    <div class="section-label">Choose your weapon</div>

    <div class="tools-diag">

      <!-- LinkedIn Reality Check -->
      <div class="tool-card card-roaster" style="--tc:var(--roaster)" onclick="openModal('roaster')">
        <div class="diag-left">
          <div class="diag-num">01</div>
          <div class="diag-icon">💼</div>
        </div>
        <div class="diag-right">
          <div class="tool-name">LINKEDIN REALITY CHECK</div>
          <p class="tool-desc">Your LinkedIn sounds like ChatGPT wrote it during a corporate crisis. We fix it — or write it from scratch.</p>
          <div class="diag-meta">
            <span class="tool-xp">+25 XP</span>
            <div class="diag-modes"><span class="tool-tag">✓ Check</span><span class="tool-tag">+ Create</span></div>
          </div>
        </div>
      </div>

      <!-- Idea Checker -->
      <div class="tool-card card-idea" style="--tc:var(--idea)" onclick="openModal('idea')">
        <div class="diag-left">
          <div class="diag-num">02</div>
          <div class="diag-icon">💡</div>
        </div>
        <div class="diag-right">
          <div class="tool-name">IDEA CHECKER</div>
          <p class="tool-desc">Already built, pivoted, and failed twice. Let's find out — or generate 3 tailored ideas built around you.</p>
          <div class="diag-meta">
            <span class="tool-xp">+30 XP</span>
            <div class="diag-modes"><span class="tool-tag">✓ Check</span><span class="tool-tag">+ Generate</span></div>
          </div>
        </div>
      </div>

      <!-- Stack Picker -->
      <div class="tool-card card-stack" style="--tc:var(--stack)" onclick="openModal('stack')">
        <div class="diag-left">
          <div class="diag-num">03</div>
          <div class="diag-icon">⚙️</div>
        </div>
        <div class="diag-right">
          <div class="tool-name">STACK PICKER</div>
          <p class="tool-desc">One answer. No hedging. Stop arguing at 2am. Or tell us your interests — we'll find you something to build.</p>
          <div class="diag-meta">
            <span class="tool-xp">+20 XP</span>
            <div class="diag-modes"><span class="tool-tag">✓ Decide</span><span class="tool-tag">+ Suggest</span></div>
          </div>
        </div>
      </div>

      <!-- Resume Roaster -->
      <div class="tool-card card-resume" style="--tc:var(--resume)" onclick="openModal('resume')">
        <div class="diag-left">
          <div class="diag-num">04</div>
          <div class="diag-icon">📄</div>
        </div>
        <div class="diag-right">
          <div class="tool-name">RESUME ROASTER</div>
          <p class="tool-desc">HR deleted it before the first bullet. Here's why — and the version they'll actually read. Or we build it clean.</p>
          <div class="diag-meta">
            <span class="tool-xp">+35 XP</span>
            <div class="diag-modes"><span class="tool-tag">✓ Fix</span><span class="tool-tag">+ Build</span></div>
          </div>
        </div>
      </div>

    </div>
  </section>

  <!-- MODALS -->

  <!-- LinkedIn Reality Check Modal -->
  <div class="modal-overlay" id="modal-roaster">
    <div class="modal modal-wide modal-roaster">
      <button class="modal-close" onclick="closeModal('roaster')">✕</button>
      <div class="modal-title">LINKEDIN REALITY CHECK</div>
      <div class="modal-sub" id="li-modal-sub">// paste it. we'll tell you if it slaps or flops.</div>
      <div class="modal-columns">
        <!-- Left: Inputs -->
        <div class="modal-left">
          <!-- CHECK / CREATE tab -->
          <div class="tool-tabs">
            <button class="tool-tab active" id="li-tab-check" onclick="switchLiMode('check')">⚡ CHECK</button>
            <button class="tool-tab" id="li-tab-create" onclick="switchLiMode('create')">✦ CREATE</button>
          </div>

          <!-- CHECK mode inputs -->
          <div class="input-mode active" id="li-mode-check">
            <div class="mode-toggle">
              <button class="mode-btn active" id="btn-li-post" onclick="switchLinkedInType('post')">Post</button>
              <button class="mode-btn" id="btn-li-bio" onclick="switchLinkedInType('bio')">Bio</button>
              <button class="mode-btn" id="btn-li-headline" onclick="switchLinkedInType('headline')">Headline</button>
              <button class="mode-btn" id="btn-li-connect" onclick="switchLinkedInType('connection_request')">Connection Req</button>
            </div>
            <div class="field">
              <label id="linkedin-content-label">Your LinkedIn Post</label>
              <textarea id="linkedin-content" placeholder="Paste your LinkedIn post here..." style="min-height: 140px;"></textarea>
            </div>
            <input type="hidden" id="linkedin-type" value="post"/>
          </div>

          <!-- CREATE mode inputs -->
          <div class="input-mode" id="li-mode-create">
            <div class="mode-toggle">
              <button class="mode-btn active" id="btn-li-create-post" onclick="switchLinkedInCreateType('post')">Post</button>
              <button class="mode-btn" id="btn-li-create-bio" onclick="switchLinkedInCreateType('bio')">Bio</button>
              <button class="mode-btn" id="btn-li-create-headline" onclick="switchLinkedInCreateType('headline')">Headline</button>
              <button class="mode-btn" id="btn-li-create-connect" onclick="switchLinkedInCreateType('connection_request')">Connection Req</button>
            </div>
            <input type="hidden" id="linkedin-create-type" value="post"/>
            <div class="field">
              <label id="li-intent-label">What do you want to say?</label>
              <textarea id="linkedin-intent" placeholder="e.g. I want to share that I just launched my first SaaS product after 6 months of building it solo. Want to talk about what I learned." style="min-height: 140px;"></textarea>
            </div>
          </div>

          <div class="field">
            <label>Roast Style</label>
            <select id="roaster-comic">
              {% for c in comic_options %}
              <option value="{{ c.id }}">{{ c.name }} — {{ c.vibe }}</option>
              {% endfor %}
            </select>
          </div>
          <button class="submit-btn" id="li-submit-btn" onclick="submitLinkedIn()">CHECK IT 💼</button>
        </div>

        <!-- Right: Output -->
        <div class="modal-right">
          <div class="verdict-panel" id="verdict-panel">
            <div class="verdict-waiting" id="verdict-waiting">
              <div class="verdict-icon">💼</div>
              <div class="verdict-placeholder">// awaiting your content...</div>
              <div class="verdict-hint">Paste your LinkedIn content and hit Check It</div>
            </div>
            <div class="verdict-result" id="verdict-result" style="display:none">
              <div class="result-label" id="li-result-label">// verdict</div>
              <div class="result-label" id="linkedin-verdict-label" style="font-size:11px;opacity:0.6;margin-bottom:6px;"></div>
              <div id="roaster-text"></div>
              <div id="linkedin-fixed-text" style="margin-top:16px; padding-top:16px; border-top:1px solid var(--border);"></div>
              <div class="xp-toast" id="roaster-xp"></div>
              <button class="share-btn" id="roaster-share-btn" onclick="openSharePanel('roaster')">⬡ SHARE RESULT</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Idea Checker Modal -->
  <div class="modal-overlay" id="modal-idea">
    <div class="modal modal-wide modal-idea">
      <button class="modal-close" onclick="closeModal('idea')">✕</button>
      <div class="modal-title">IDEA CHECKER</div>
      <div class="modal-sub">// how original are you, really?</div>
      <div class="modal-columns">
        <div class="modal-left">
          <!-- CHECK / CREATE tab -->
          <div class="tool-tabs">
            <button class="tool-tab active" id="idea-tab-check" onclick="switchIdeaMode('check')">⚡ CHECK</button>
            <button class="tool-tab" id="idea-tab-create" onclick="switchIdeaMode('create')">✦ CREATE</button>
          </div>

          <!-- CHECK mode -->
          <div class="input-mode active" id="idea-mode-check">
            <div class="field">
              <label>Your Idea</label>
              <input type="text" id="idea-input" placeholder="e.g. An app that delivers repair services instantly"/>
            </div>
            <div class="field">
              <label>Target Market</label>
              <input type="text" id="idea-market" placeholder="e.g. Indian urban millennials"/>
            </div>
          </div>

          <!-- CREATE mode -->
          <div class="input-mode" id="idea-mode-create">
            <!-- Step indicator -->
            <div class="q-steps" id="idea-q-steps">
              <div class="q-step-dot active" id="idea-dot-0"></div>
              <div class="q-step-dot" id="idea-dot-1"></div>
              <div class="q-step-dot" id="idea-dot-2"></div>
            </div>
            <div class="q-step-label" id="idea-q-label">Step 1 of 3 — Who are you?</div>

            <!-- Step 1: Who are you -->
            <div class="q-panel active" id="idea-qp-0">
              <div class="field">
                <label>What do you do right now?</label>
                <div class="q-chips" id="idea-chips-role">
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-role')">Student</div>
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-role')">Working professional</div>
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-role')">Freelancer</div>
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-role')">Between things</div>
                </div>
              </div>
              <div class="field">
                <label>Your strongest skills</label>
                <input type="text" id="idea-skills" placeholder="e.g. Python, design, marketing, writing"/>
              </div>
              <div class="field">
                <label>Something you're good at that most people aren't</label>
                <input type="text" id="idea-edge" placeholder="e.g. I explain complex things simply, I know Tier-2 markets"/>
              </div>
              <div class="q-nav">
                <button class="q-btn-next" onclick="ideaNextStep(1)">NEXT →</button>
              </div>
            </div>

            <!-- Step 2: What drives you -->
            <div class="q-panel" id="idea-qp-1">
              <div class="field">
                <label>Domains or problems that excite you</label>
                <input type="text" id="idea-interests" placeholder="e.g. education, logistics, content creators, health"/>
              </div>
              <div class="field">
                <label>Building for?</label>
                <div class="q-chips" id="idea-chips-market">
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-market')">India</div>
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-market')">Global</div>
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-market')">Both</div>
                </div>
              </div>
              <div class="field">
                <label>Type of idea you're open to</label>
                <div class="q-chips" id="idea-chips-type">
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-type')">SaaS</div>
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-type')">App</div>
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-type')">Community</div>
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-type')">Services</div>
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-type')">Anything</div>
                </div>
              </div>
              <div class="q-nav">
                <button class="q-btn-back" onclick="ideaNextStep(0)">← BACK</button>
                <button class="q-btn-next" onclick="ideaNextStep(2)">NEXT →</button>
              </div>
            </div>

            <!-- Step 3: Reality check -->
            <div class="q-panel" id="idea-qp-2">
              <div class="field">
                <label>How much time can you commit?</label>
                <div class="q-chips" id="idea-chips-time">
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-time')">Side project</div>
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-time')">Part time</div>
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-time')">Full time</div>
                </div>
              </div>
              <div class="field">
                <label>Budget to start?</label>
                <div class="q-chips" id="idea-chips-budget">
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-budget')">Zero</div>
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-budget')">Under ₹10k</div>
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-budget')">Some runway</div>
                </div>
              </div>
              <div class="field">
                <label>Building alone or with a team?</label>
                <div class="q-chips" id="idea-chips-team">
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-team')">Solo</div>
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-team')">Have a team</div>
                  <div class="q-chip" onclick="selectChip(this,'idea-chips-team')">Need to find one</div>
                </div>
              </div>
              <div class="q-nav">
                <button class="q-btn-back" onclick="ideaNextStep(1)">← BACK</button>
              </div>
            </div>
          </div>

          <button class="submit-btn" id="idea-submit-btn" onclick="submitIdea()">CHECK MY IDEA 💡</button>
        </div>
        <div class="modal-right">
          <div class="verdict-panel">
            <div class="verdict-waiting" id="idea-verdict-waiting">
              <div class="verdict-icon">💡</div>
              <div class="verdict-placeholder">// awaiting analysis...</div>
              <div class="verdict-hint">Describe your idea and hit Check</div>
            </div>
            <div class="verdict-result" id="idea-verdict-result" style="display:none">
              <div class="result-label" id="idea-result-label">// the analysis</div>
              <div id="idea-text"></div>
              <div class="xp-toast" id="idea-xp"></div>
              <button class="share-btn" id="idea-share-btn" onclick="openSharePanel('idea')">⬡ SHARE RESULT</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Stack Picker Modal -->
  <div class="modal-overlay" id="modal-stack">
    <div class="modal modal-wide modal-stack">
      <button class="modal-close" onclick="closeModal('stack')">✕</button>
      <div class="modal-title">STACK PICKER</div>
      <div class="modal-sub">// no more analysis paralysis</div>
      <div class="modal-columns">
        <div class="modal-left">
          <!-- CHECK / CREATE tab -->
          <div class="tool-tabs">
            <button class="tool-tab active" id="stack-tab-check" onclick="switchStackMode('check')">⚡ CHECK</button>
            <button class="tool-tab" id="stack-tab-create" onclick="switchStackMode('create')">✦ CREATE</button>
          </div>

          <!-- CHECK mode -->
          <div class="input-mode active" id="stack-mode-check">
            <div class="field">
              <label>What are you building?</label>
              <input type="text" id="stack-project" placeholder="e.g. A social media app for pet owners"/>
            </div>
            <div class="fields-row">
              <div class="field">
                <label>Your Experience Level</label>
                <select id="stack-level">
                  <option value="beginner">Beginner</option>
                  <option value="intermediate">Intermediate</option>
                  <option value="advanced">Advanced</option>
                </select>
              </div>
              <div class="field">
                <label>Priority</label>
                <select id="stack-priority">
                  <option value="speed">Ship Fast</option>
                  <option value="scale">Scale Big</option>
                  <option value="learn">Learn Most</option>
                </select>
              </div>
            </div>
          </div>

          <!-- CREATE mode -->
          <div class="input-mode" id="stack-mode-create">
            <!-- Step indicator -->
            <div class="q-steps" id="stack-q-steps">
              <div class="q-step-dot active" id="stack-dot-0"></div>
              <div class="q-step-dot" id="stack-dot-1"></div>
              <div class="q-step-dot" id="stack-dot-2"></div>
            </div>
            <div class="q-step-label" id="stack-q-label">Step 1 of 3 — Your level</div>

            <!-- Step 1: Your level -->
            <div class="q-panel active" id="stack-qp-0">
              <div class="field">
                <label>How long have you been coding?</label>
                <div class="q-chips" id="stack-chips-exp">
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-exp')">Just started</div>
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-exp')">6mo - 1yr</div>
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-exp')">1-2 years</div>
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-exp')">2+ years</div>
                </div>
              </div>
              <div class="field">
                <label>What do you prefer building?</label>
                <div class="q-chips" id="stack-chips-pref">
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-pref')">Frontend</div>
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-pref')">Backend</div>
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-pref')">Fullstack</div>
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-pref')">No idea yet</div>
                </div>
              </div>
              <div class="field">
                <label>Biggest thing you've shipped so far</label>
                <input type="text" id="stack-shipped" placeholder="e.g. a todo app, nothing yet, a college portal"/>
              </div>
              <div class="q-nav">
                <button class="q-btn-next" onclick="stackNextStep(1)">NEXT →</button>
              </div>
            </div>

            <!-- Step 2: Your goal -->
            <div class="q-panel" id="stack-qp-1">
              <div class="field">
                <label>Why are you building this?</label>
                <div class="q-chips" id="stack-chips-goal">
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-goal')">Get a job</div>
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-goal')">Learn properly</div>
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-goal')">Build a startup</div>
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-goal')">Freelance</div>
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-goal')">Just for fun</div>
                </div>
              </div>
              <div class="field">
                <label>Time you can commit weekly</label>
                <div class="q-chips" id="stack-chips-time">
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-time')">Under 5hrs</div>
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-time')">5-10hrs</div>
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-time')">10-20hrs</div>
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-time')">Full time</div>
                </div>
              </div>
              <div class="field">
                <label>Deadline pressure?</label>
                <div class="q-chips" id="stack-chips-deadline">
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-deadline')">No rush</div>
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-deadline')">1-2 months</div>
                  <div class="q-chip" onclick="selectChip(this,'stack-chips-deadline')">I needed this yesterday</div>
                </div>
              </div>
              <div class="q-nav">
                <button class="q-btn-back" onclick="stackNextStep(0)">← BACK</button>
                <button class="q-btn-next" onclick="stackNextStep(2)">NEXT →</button>
              </div>
            </div>

            <!-- Step 3: Interests & constraints -->
            <div class="q-panel" id="stack-qp-2">
              <div class="field">
                <label>Domains that excite you</label>
                <input type="text" id="stack-interests" placeholder="e.g. fintech, games, AI, health, education"/>
              </div>
              <div class="field">
                <label>Languages / frameworks you've touched</label>
                <input type="text" id="stack-known" placeholder="e.g. React, basic Python, nothing yet"/>
              </div>
              <div class="field">
                <label>Something specific you want to learn from this</label>
                <input type="text" id="stack-learn" placeholder="e.g. databases, APIs, auth, deployment"/>
              </div>
              <div class="q-nav">
                <button class="q-btn-back" onclick="stackNextStep(1)">← BACK</button>
              </div>
            </div>
          </div>

          <button class="submit-btn" id="stack-submit-btn" onclick="submitStack()">PICK MY STACK ⚙️</button>
        </div>
        <div class="modal-right">
          <div class="verdict-panel">
            <div class="verdict-waiting" id="stack-verdict-waiting">
              <div class="verdict-icon">⚙️</div>
              <div class="verdict-placeholder">// awaiting recommendation...</div>
              <div class="verdict-hint">Describe your project and hit Pick My Stack</div>
            </div>
            <div class="verdict-result" id="stack-verdict-result" style="display:none">
              <div class="result-label" id="stack-result-label">// your stack</div>
              <div id="stack-text"></div>
              <div class="xp-toast" id="stack-xp"></div>
              <button class="share-btn" id="stack-share-btn" onclick="openSharePanel('stack')">⬡ SHARE RESULT</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Resume Roaster Modal -->
  <div class="modal-overlay" id="modal-resume">
    <div class="modal modal-wide modal-resume">
      <button class="modal-close" onclick="closeModal('resume')">✕</button>
      <div class="modal-title">RESUME ROASTER</div>
      <div class="modal-sub" id="resume-modal-sub">// we'll fix it. but we won't be nice about it.</div>
      <div class="modal-columns">
        <!-- Left: Inputs -->
        <div class="modal-left">
          <!-- CHECK / CREATE main tab -->
          <div class="tool-tabs">
            <button class="tool-tab active" id="resume-tab-check" onclick="switchResumeMainMode('check')">⚡ CHECK</button>
            <button class="tool-tab" id="resume-tab-create" onclick="switchResumeMainMode('create')">✦ CREATE</button>
          </div>

          <!-- CHECK mode -->
          <div class="input-mode active" id="resume-main-check">
            <div class="mode-toggle">
              <button class="mode-btn active" id="btn-paste" onclick="switchResumeMode('paste')">Paste Resume</button>
              <button class="mode-btn" id="btn-form" onclick="switchResumeMode('form')">Fill Form</button>
            </div>
            <!-- Paste mode -->
            <div class="input-mode active" id="resume-mode-paste">
              <div class="field">
                <label>Your Resume Text</label>
                <textarea id="resume-text" placeholder="Paste your full resume here — skills, experience, education, the works..."></textarea>
              </div>
            </div>
            <!-- Form mode -->
            <div class="input-mode" id="resume-mode-form">
              <div class="fields-row">
                <div class="field">
                  <label>Full Name</label>
                  <input type="text" id="form-name" placeholder="e.g. Pushkar Gupta"/>
                </div>
                <div class="field">
                  <label>Target Role</label>
                  <input type="text" id="form-role" placeholder="e.g. Backend Developer"/>
                </div>
              </div>
              <div class="field">
                <label>Work Experience</label>
                <textarea id="form-experience" placeholder="e.g. 6 month internship at XYZ, built a Flask API..." style="min-height: 70px;"></textarea>
              </div>
              <div class="field">
                <label>Projects</label>
                <textarea id="form-projects" placeholder="e.g. ANVIL — AI tool platform with Groq, Flask, Supabase." style="min-height: 70px;"></textarea>
              </div>
              <div class="fields-row">
                <div class="field">
                  <label>Skills</label>
                  <input type="text" id="form-skills" placeholder="e.g. Python, Flask, SQL"/>
                </div>
                <div class="field">
                  <label>Education</label>
                  <input type="text" id="form-education" placeholder="e.g. B.Tech CSE, PTU"/>
                </div>
              </div>
            </div>
          </div>

          <!-- CREATE mode — generates a full resume from scratch -->
          <div class="input-mode" id="resume-main-create">
            <div class="fields-row">
              <div class="field">
                <label>Full Name</label>
                <input type="text" id="create-name" placeholder="e.g. Pushkar Gupta"/>
              </div>
              <div class="field">
                <label>Target Role</label>
                <input type="text" id="create-role" placeholder="e.g. Backend Developer"/>
              </div>
            </div>
            <div class="field">
              <label>Work Experience <span style="opacity:0.5;font-size:10px;">(rough notes ok)</span></label>
              <textarea id="create-experience" placeholder="e.g. 6 month internship at a logistics startup, worked on their API and dashboard" style="min-height: 65px;"></textarea>
            </div>
            <div class="field">
              <label>Projects</label>
              <textarea id="create-projects" placeholder="e.g. ANVIL — AI satire platform, live on Render. Built with Flask, Groq, Supabase." style="min-height: 65px;"></textarea>
            </div>
            <div class="fields-row">
              <div class="field">
                <label>Skills</label>
                <input type="text" id="create-skills" placeholder="e.g. Python, React, AWS"/>
              </div>
              <div class="field">
                <label>Education</label>
                <input type="text" id="create-education" placeholder="e.g. B.Tech CSE, PTU, 2025"/>
              </div>
            </div>
          </div>

          <div class="field">
            <label>Style</label>
            <select id="resume-comic">
              {% for c in comic_options %}
              <option value="{{ c.id }}">{{ c.name }} — {{ c.vibe }}</option>
              {% endfor %}
            </select>
          </div>
          <button class="submit-btn" id="resume-submit-btn" onclick="submitResume(this)">ROAST MY RESUME 📄</button>
        </div>

        <!-- Right: Output -->
        <div class="modal-right">
          <div class="verdict-panel" style="min-height: 380px;">
            <div class="verdict-waiting" id="resume-verdict-waiting">
              <div class="verdict-icon">📄</div>
              <div class="verdict-placeholder">// awaiting your resume...</div>
              <div class="verdict-hint">Paste or fill your details and hit Roast</div>
            </div>
            <div class="verdict-split" id="resume-verdict-result" style="display:none;">
              <div class="verdict-half roast-half" id="resume-roast-section">
                <div class="verdict-half-label roast-label">// the roast</div>
                <div class="verdict-half-text" id="resume-roast-text"></div>
              </div>
              <div class="verdict-half fix-half">
                <div class="verdict-half-label fix-label" id="resume-fixed-label">// fixed version</div>
                <div class="verdict-half-text" id="resume-fixed-text"></div>
              </div>
              <div class="verdict-half" id="resume-why-section" style="display:none;">
                <div class="verdict-half-label" style="color:var(--blue);">// why it's better</div>
                <div class="verdict-half-text" id="resume-why-text"></div>
              </div>
              <div style="padding: 12px 24px; border-top: 1px solid var(--border); display:flex; align-items:center; justify-content:space-between;">
                <div class="xp-toast" id="resume-xp"></div>
                <button class="share-btn" id="resume-share-btn" onclick="openSharePanel('resume')" style="margin-top:0;">⬡ SHARE RESULT</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ── Gamification ──
    let xp = parseInt(localStorage.getItem('fis_xp') || '0');
    let uses = parseInt(localStorage.getItem('fis_uses') || '0');
    let streak = parseInt(localStorage.getItem('fis_streak') || '0');

    const LEVELS = [
      { name: 'FRESHER',   max: 150 },
      { name: 'INTERN',    max: 150 },
      { name: 'JUGAADU',   max: 150 },
      { name: 'BUILDER',   max: 150 },
      { name: 'HACKER',    max: 150 },
      { name: 'WIZARD',    max: 150 },
      { name: 'LEGEND',    max: 150 },
      { name: 'SOVEREIGN', max: Infinity }
    ];

    function getCurrentLevel() {
      let total = 0;
      for (let i = 0; i < LEVELS.length; i++) {
        if (xp < total + LEVELS[i].max) return { idx: i, name: LEVELS[i].name, earned: xp - total, max: LEVELS[i].max };
        total += LEVELS[i].max;
      }
      return { idx: LEVELS.length - 1, name: 'SOVEREIGN', earned: xp - 1050, max: 150 };
    }

    function updateUI() {
      const lvl = getCurrentLevel();
      const pct = Math.min(100, (lvl.earned / lvl.max) * 100);
      document.getElementById('xpFill').style.width = pct + '%';
      document.getElementById('levelLabel').textContent = `LVL ${lvl.idx + 1} — ${lvl.name}`;
      document.getElementById('xpPoints').textContent = `${lvl.earned} / ${lvl.max} XP`;

      // HUD
      document.getElementById('hudXP').textContent = xp;
      document.getElementById('hudUses').textContent = uses;
      document.getElementById('hudStreak').textContent = streak;

      // Streak fire intensity
      const fireEl = document.getElementById('streakFire');
      if (streak >= 7) fireEl.textContent = '🔥🔥🔥';
      else if (streak >= 3) fireEl.textContent = '🔥🔥';
      else fireEl.textContent = '🔥';

      // Hero stats
      document.getElementById('statXP').textContent = xp;
      document.getElementById('statUses').textContent = uses;
      document.getElementById('statStreak').textContent = streak;
    }

    function showXPFloat(amount, el) {
      const rect = el.getBoundingClientRect();
      const float = document.createElement('div');
      float.className = 'xp-float';
      float.textContent = `+${amount} XP`;
      float.style.left = rect.left + rect.width / 2 + 'px';
      float.style.top = rect.top + window.scrollY - 10 + 'px';
      document.body.appendChild(float);
      setTimeout(() => float.remove(), 1300);
    }

    function showLevelUp(levelName) {
      const banner = document.getElementById('levelupBanner');
      document.getElementById('levelupSub').textContent = `// you are now a ${levelName}`;
      banner.classList.add('show');
      setTimeout(() => banner.classList.remove('show'), 3000);
    }

    function addXP(amount, triggerEl) {
      const prevLevel = getCurrentLevel().idx;
      const prevXP = xp;
      xp += amount;
      uses += 1;
      localStorage.setItem('fis_xp', xp);
      localStorage.setItem('fis_uses', uses);
      const newLevel = getCurrentLevel();
      updateUI();
      if (triggerEl) showXPFloat(amount, triggerEl);
      if (newLevel.idx > prevLevel) showLevelUp(newLevel.name);
      checkNewUnlocks(prevXP);
      applyComicLocks();
      // Sync to Supabase if logged in
      if (window.__anvilUser) {
        fetch('/api/user/xp', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ xp, streak, tools_used: uses })
        }).catch(() => {});
      }
      return amount;
    }

    // ── Auth state ──
    // ── DRAWER ──
    function toggleDrawer() {
      const drawer = document.getElementById('drawer');
      const overlay = document.getElementById('drawerOverlay');
      const hamburger = document.getElementById('hamburger');
      const isOpen = drawer.classList.contains('open');
      drawer.classList.toggle('open', !isOpen);
      overlay.classList.toggle('open', !isOpen);
      hamburger.classList.toggle('open', !isOpen);
    }

    function closeDrawer() {
      document.getElementById('drawer').classList.remove('open');
      document.getElementById('drawerOverlay').classList.remove('open');
      document.getElementById('hamburger').classList.remove('open');
    }

    function drawerNav(target) {
      closeDrawer();
      setTimeout(() => {
        if (target === 'leaderboard') { openLeaderboard(); }
        else { navScrollTo(target); }
      }, 300);
    }

    function navScrollTo(target) {
      const el = document.getElementById(target);
      if (!el) return;
      const navH = document.querySelector('nav').offsetHeight;
      const hudH = document.querySelector('.hud').offsetHeight;
      const top = el.getBoundingClientRect().top + window.scrollY - navH - hudH - 16;
      window.scrollTo({ top, behavior: 'smooth' });
    }

    // ── LEADERBOARD ──
    const LB_LEVEL_NAMES = ['FRESHER','INTERN','JUNIOR','SENIOR','LEAD','WIZARD'];
    const LB_LEVEL_THRESHOLDS = [0, 150, 350, 700, 1200, 2000];
    function getLevelName(xp) {
      for (let i = LB_LEVEL_THRESHOLDS.length - 1; i >= 0; i--) {
        if (xp >= LB_LEVEL_THRESHOLDS[i]) return LB_LEVEL_NAMES[i];
      }
      return 'FRESHER';
    }
    function rankEmoji(r) { return r === 1 ? '🥇' : r === 2 ? '🥈' : r === 3 ? '🥉' : r; }
    function rankClass(r) { return r <= 3 ? `top-${r}` : ''; }

    function buildLbRow(entry) {
      const avatar = entry.avatar_url
        ? `<img class="lb-avatar" src="${entry.avatar_url}" alt="av"/>`
        : `<div class="lb-avatar-placeholder">👤</div>`;
      return `<div class="lb-row ${rankClass(entry.rank)}">
        <div class="lb-rank">${rankEmoji(entry.rank)}</div>
        ${avatar}
        <div class="lb-info">
          <div class="lb-name">${entry.display_name || 'Anonymous'}</div>
          <div class="lb-level">${getLevelName(entry.xp)}</div>
        </div>
        <div style="text-align:right">
          <div class="lb-xp">${entry.xp}</div>
          <div class="lb-xp-label">XP</div>
        </div>
      </div>`;
    }

    const ALL_ACHIEVEMENTS = [
      { id: 'first_blood',          icon: '🩸', name: 'First Blood' },
      { id: 'financially_deceased', icon: '💀', name: 'Financially Deceased' },
      { id: 'anvil_veteran',        icon: '⚡', name: 'ANVIL Veteran' },
      { id: 'resume_arc',           icon: '📄', name: 'Resume Arc' },
      { id: 'comic_collector',      icon: '🎭', name: 'Comic Collector' },
      { id: 'clown_input',          icon: '🤡', name: 'Clown Input' },
      { id: 'seven_day_streak',     icon: '🔥', name: '7 Day Streak' },
      { id: 'stack_overflowed',     icon: '⚙️', name: 'Stack Overflowed' },
      { id: 'idea_assassin',        icon: '🗡️', name: 'Idea Assassin' },
      { id: 'xp_hoarder',          icon: '💰', name: 'XP Hoarder' },
      { id: 'comeback_kid',         icon: '🔄', name: 'Comeback Kid' },
      { id: 'showoff',              icon: '📢', name: 'Showoff' },
    ];

    async function loadGlobalLb() {
      try {
        const res = await fetch('/api/leaderboard');
        const data = await res.json();
        document.getElementById('lb-global-loading').style.display = 'none';
        const list = document.getElementById('lb-global-list');
        list.innerHTML = data.length
          ? data.map(buildLbRow).join('')
          : '<div class="lb-empty">// no warriors yet. be the first.</div>';
      } catch(e) {
        document.getElementById('lb-global-loading').innerText = '// failed to load. try again.';
      }
    }

    async function loadWeeklyLb() {
      try {
        const res = await fetch('/api/leaderboard/weekly');
        const data = await res.json();
        document.getElementById('lb-weekly-loading').style.display = 'none';
        const list = document.getElementById('lb-weekly-list');
        list.innerHTML = data.length
          ? data.map(buildLbRow).join('')
          : '<div class="lb-empty">// nobody has grinded this week yet.</div>';
      } catch(e) {
        document.getElementById('lb-weekly-loading').innerText = '// failed to load. try again.';
      }
    }

    async function loadPersonalLb() {
      const content = document.getElementById('lb-personal-content');
      if (!window.__anvilUser) {
        // Guest — show local stats with Anonymous
        const unlockedIds = new Set();
        const achievementsHtml = ALL_ACHIEVEMENTS.map(a =>
          `<div class="lb-achievement locked">
            <span class="lb-achievement-icon">${a.icon}</span>
            <span>${a.name}</span>
          </div>`).join('');
        content.innerHTML = `<div class="lb-personal-wrap">
          <div class="lb-personal-card">
            <div>
              <div class="lb-personal-name">ANONYMOUS</div>
              <div class="lb-personal-rank">// GLOBAL RANK #— · ${getLevelName(xp)}</div>
            </div>
          </div>
          <div class="lb-personal-stats">
            <div class="lb-stat-box"><div class="lb-stat-num" style="color:var(--accent)">${xp}</div><div class="lb-stat-label">Total XP</div></div>
            <div class="lb-stat-box"><div class="lb-stat-num" style="color:#ff6b35">${streak}🔥</div><div class="lb-stat-label">Streak</div></div>
            <div class="lb-stat-box"><div class="lb-stat-num" style="color:#00e5ff">${uses}</div><div class="lb-stat-label">Tools Used</div></div>
          </div>
          <div class="lb-achievements-title">// achievements</div>
          <div class="lb-achievements-grid">${achievementsHtml}</div>
          <div style="margin-top:20px;text-align:center;">
            <p style="font-family:var(--mono);font-size:11px;color:var(--text-dim);margin-bottom:12px;">// sign in to save your rank and unlock achievements</p>
            <button class="lb-signin-btn" onclick="window.location.href='/auth/login'">⬡ SIGN IN WITH GOOGLE</button>
          </div>
        </div>`;
        return;
      }
      content.innerHTML = '<div class="lb-loading">// loading your stats...</div>';
      try {
        const res = await fetch('/api/leaderboard/personal');
        const d = await res.json();
        // Get name + avatar from the meta tag Flask injected — API only returns stats
        const userMeta = document.getElementById('anvil-user-meta');
        const userName = userMeta ? userMeta.dataset.name : 'Anonymous';
        const userAvatar = userMeta ? userMeta.dataset.avatar : '';
        const unlockedIds = new Set((d.achievements || []).map(a => a.achievement_id));
        const achievementsHtml = ALL_ACHIEVEMENTS.map(a =>
          `<div class="lb-achievement ${unlockedIds.has(a.id) ? '' : 'locked'}">
            <span class="lb-achievement-icon">${a.icon}</span>
            <span>${a.name}</span>
          </div>`).join('');
        content.innerHTML = `<div class="lb-personal-wrap">
          <div class="lb-personal-card">
            <img class="lb-personal-avatar" src="${userAvatar}" alt="av" onerror="this.style.display='none'"/>
            <div>
              <div class="lb-personal-name">${userName}</div>
              <div class="lb-personal-rank">// GLOBAL RANK #${d.rank || '—'} · ${getLevelName(d.xp)}</div>
            </div>
          </div>
          <div class="lb-personal-stats">
            <div class="lb-stat-box"><div class="lb-stat-num" style="color:var(--accent)">${d.xp}</div><div class="lb-stat-label">Total XP</div></div>
            <div class="lb-stat-box"><div class="lb-stat-num" style="color:#ff6b35">${d.streak}🔥</div><div class="lb-stat-label">Streak</div></div>
            <div class="lb-stat-box"><div class="lb-stat-num" style="color:#00e5ff">${d.tools_used}</div><div class="lb-stat-label">Tools Used</div></div>
          </div>
          <div class="lb-achievements-title">// achievements</div>
          <div class="lb-achievements-grid">${achievementsHtml}</div>
        </div>`;
      } catch(e) {
        content.innerHTML = '<div class="lb-empty">// failed to load your stats.</div>';
      }
    }

    let lbLoaded = { global: false, weekly: false, personal: false };

    function openLeaderboard() {
      document.getElementById('lbOverlay').classList.add('active');
      if (!lbLoaded.global) { loadGlobalLb(); lbLoaded.global = true; }
    }

    function closeLeaderboard() {
      document.getElementById('lbOverlay').classList.remove('active');
    }

    function switchLbTab(tab) {
      ['global','weekly','personal'].forEach(t => {
        document.getElementById(`lb-${t}`).classList.toggle('active', t === tab);
        document.getElementById(`lb-tab-${t}`).classList.toggle('active', t === tab);
      });
      if (tab === 'weekly' && !lbLoaded.weekly) { loadWeeklyLb(); lbLoaded.weekly = true; }
      if (tab === 'personal' && !lbLoaded.personal) { loadPersonalLb(); lbLoaded.personal = true; }
    }

    document.addEventListener('keydown', e => { if (e.key === 'Escape') { closeLeaderboard(); closeDrawer(); } });

    function confirmLogout() {
      document.getElementById('logoutConfirm').classList.add('show');
    }
    function cancelLogout() {
      document.getElementById('logoutConfirm').classList.remove('show');
    }
    function doLogout() {
      window.location.href = '/auth/logout';
    }

    async function initAuthState() {
      try {
        const res = await fetch('/api/user/stats');
        if (res.ok) {
          const data = await res.json();
          // Logged in — load stats from Supabase
          window.__anvilUser = true;
          // Only migrate if Supabase XP is less than local (first login migration)
          if (data.xp >= xp) {
            xp = data.xp;
            streak = data.streak || streak;
            uses = data.tools_used || uses;
            localStorage.setItem('fis_xp', xp);
            localStorage.setItem('fis_uses', uses);
            updateUI();
            applyComicLocks();
          }
          // Show user in nav
          document.getElementById('nav-login-btn').style.display = 'none';
          document.getElementById('nav-user').style.display = 'flex';
          // Get user info from meta tag injected by Flask
          const userMeta = document.getElementById('anvil-user-meta');
          if (userMeta) {
            document.getElementById('nav-username').textContent = userMeta.dataset.name;
            document.getElementById('nav-avatar').src = userMeta.dataset.avatar;
          }
        } else {
          window.__anvilUser = false;
        }
      } catch(e) {
        window.__anvilUser = false;
      }
    }

    initAuthState();

    // Streak logic
    const today = new Date().toDateString();
    const lastVisit = localStorage.getItem('fis_last_visit');
    const yesterday = new Date(Date.now() - 86400000).toDateString();
    if (lastVisit === yesterday) { streak += 1; }
    else if (lastVisit !== today) { streak = 1; }
    localStorage.setItem('fis_last_visit', today);
    localStorage.setItem('fis_streak', streak);

    updateUI();

    // ── Comic Unlock System ──
    const COMIC_UNLOCKS = [
      { value: 'abhishek_upmanyu', name: 'Abhishek Upmanyu', xpRequired: 0 },
      { value: 'samay_raina',      name: 'Samay Raina',      xpRequired: 0 },
      { value: 'ravi_gupta',       name: 'Ravi Gupta',       xpRequired: 150 },
      { value: 'anubhav_bassi',    name: 'Anubhav Singh Bassi', xpRequired: 450 },
      { value: 'ashish_solanki',   name: 'Ashish Solanki',   xpRequired: 450 },
      { value: 'kaustubh_aggarwal',name: 'Kaustubh Aggarwal',xpRequired: 750 },
      { value: 'madhur_virli',     name: 'Madhur Virli',     xpRequired: 1050 },
    ];

    function applyComicLocks() {
      ['roaster-comic', 'resume-comic'].forEach(selectId => {
        const select = document.getElementById(selectId);
        if (!select) return;
        Array.from(select.options).forEach(opt => {
          const comic = COMIC_UNLOCKS.find(c => c.value === opt.value);
          if (!comic) return;
          if (xp >= comic.xpRequired) {
            opt.disabled = false;
            opt.classList.remove('locked-option');
            // restore clean label
            opt.text = opt.text.replace(/\s*🔒.*$/, '');
          } else {
            opt.disabled = true;
            opt.classList.add('locked-option');
            const baseLabel = opt.text.replace(/\s*🔒.*$/, '');
            opt.text = `${baseLabel} 🔒 ${comic.xpRequired} XP`;
            // if currently selected, switch to first unlocked
            if (opt.selected) {
              const firstUnlocked = Array.from(select.options).find(o => !o.disabled);
              if (firstUnlocked) firstUnlocked.selected = true;
            }
          }
        });
      });
    }

    function showUnlockBanner(comicName) {
      const banner = document.getElementById('unlockBanner');
      document.getElementById('unlockSub').textContent = `// ${comicName} is now available`;
      banner.classList.add('show');
      setTimeout(() => banner.classList.remove('show'), 3000);
    }

    function checkNewUnlocks(prevXP) {
      COMIC_UNLOCKS.forEach(comic => {
        if (comic.xpRequired > 0 && prevXP < comic.xpRequired && xp >= comic.xpRequired) {
          setTimeout(() => showUnlockBanner(comic.name), 500);
        }
      });
    }



    // Apply locks on page load
    applyComicLocks();
    // ── Geometric Wires Background (hero only) ──
    (function() {
      const canvas = document.getElementById('fire-canvas');
      const ctx = canvas.getContext('2d');
      let W, H, shapes = [];

      function resize() {
        W = canvas.width = canvas.offsetWidth;
        H = canvas.height = canvas.offsetHeight;
      }
      resize();
      window.addEventListener('resize', () => { resize(); buildShapes(); });

      function buildShapes() {
        shapes = [];
        const count = 14;
        for (let i = 0; i < count; i++) {
          const typeRoll = Math.random();
          shapes.push({
            type: typeRoll < 0.35 ? 'hex' : typeRoll < 0.65 ? 'triangle' : typeRoll < 0.82 ? 'rect' : 'diamond',
            x: Math.random() * W,
            y: Math.random() * H,
            size: 40 + Math.random() * 140,
            rot: Math.random() * Math.PI * 2,
            rotSpeed: (Math.random() - 0.5) * 0.0008,
            vx: (Math.random() - 0.5) * 0.18,
            vy: (Math.random() - 0.5) * 0.18,
            isAccent: Math.random() < 0.25,
            opacity: 0.08 + Math.random() * 0.14,
          });
        }
      }
      buildShapes();

      function hexPath(x, y, r, rot) {
        ctx.beginPath();
        for (let i = 0; i < 6; i++) {
          const a = rot + (i / 6) * Math.PI * 2;
          i === 0 ? ctx.moveTo(x + Math.cos(a)*r, y + Math.sin(a)*r)
                  : ctx.lineTo(x + Math.cos(a)*r, y + Math.sin(a)*r);
        }
        ctx.closePath();
      }

      function triPath(x, y, r, rot) {
        ctx.beginPath();
        for (let i = 0; i < 3; i++) {
          const a = rot + (i / 3) * Math.PI * 2 - Math.PI/2;
          i === 0 ? ctx.moveTo(x + Math.cos(a)*r, y + Math.sin(a)*r)
                  : ctx.lineTo(x + Math.cos(a)*r, y + Math.sin(a)*r);
        }
        ctx.closePath();
      }

      function rectPath(x, y, r, rot) {
        ctx.save();
        ctx.translate(x, y); ctx.rotate(rot);
        ctx.beginPath();
        ctx.rect(-r*0.9, -r*0.55, r*1.8, r*1.1);
        ctx.restore();
      }

      function diamondPath(x, y, r, rot) {
        ctx.save();
        ctx.translate(x, y); ctx.rotate(rot + Math.PI/4);
        ctx.beginPath();
        ctx.rect(-r*0.6, -r*0.6, r*1.2, r*1.2);
        ctx.restore();
      }

      function drawShape(s) {
        const col = s.isAccent ? '#ff4d00' : '#ffffff';
        ctx.save();
        ctx.strokeStyle = col;
        ctx.lineWidth = s.isAccent ? 1.5 : 1;
        ctx.globalAlpha = s.isAccent ? s.opacity * 2.5 : s.opacity * 1.8;

        if (s.type === 'hex') hexPath(s.x, s.y, s.size, s.rot);
        else if (s.type === 'triangle') triPath(s.x, s.y, s.size, s.rot);
        else if (s.type === 'rect') rectPath(s.x, s.y, s.size, s.rot);
        else diamondPath(s.x, s.y, s.size, s.rot);
        ctx.stroke();

        if (s.size > 80) {
          ctx.globalAlpha = s.isAccent ? s.opacity * 1.0 : s.opacity * 0.7;
          ctx.lineWidth = 0.5;
          if (s.type === 'hex') hexPath(s.x, s.y, s.size * 0.6, s.rot + 0.3);
          else if (s.type === 'triangle') triPath(s.x, s.y, s.size * 0.55, s.rot + 0.2);
          ctx.stroke();
        }
        ctx.restore();
      }

      function animate() {
        ctx.clearRect(0, 0, W, H);
        shapes.forEach(s => {
          s.x += s.vx; s.y += s.vy; s.rot += s.rotSpeed;
          const pad = s.size + 20;
          if (s.x < -pad) s.x = W + pad;
          if (s.x > W + pad) s.x = -pad;
          if (s.y < -pad) s.y = H + pad;
          if (s.y > H + pad) s.y = -pad;
          drawShape(s);
        });
        requestAnimationFrame(animate);
      }
      animate();
    })();

    // ── Todo List ──
    let todos = JSON.parse(localStorage.getItem('anvil_todos') || '[]');

    function saveTodos() { localStorage.setItem('anvil_todos', JSON.stringify(todos)); }

    function renderTodos() {
      const list = document.getElementById('todo-list');
      const empty = document.getElementById('todo-empty');
      list.innerHTML = '';
      if (todos.length === 0) {
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';
      todos.forEach((todo, i) => {
        const li = document.createElement('li');
        li.className = 'todo-item' + (todo.done ? ' done' : '');
        li.innerHTML = `
          <span class="todo-check" onclick="toggleTodo(${i})">${todo.done ? '✓' : '○'}</span>
          <span class="todo-text">${todo.text}</span>
          <button class="todo-delete" onclick="deleteTodo(${i})">✕</button>`;
        list.appendChild(li);
      });
    }

    function addTodo() {
      const input = document.getElementById('todo-input');
      const text = input.value.trim();
      if (!text) return;
      todos.unshift({ text, done: false });
      saveTodos();
      renderTodos();
      input.value = '';
    }

    function toggleTodo(i) {
      todos[i].done = !todos[i].done;
      saveTodos();
      renderTodos();
    }

    function deleteTodo(i) {
      todos.splice(i, 1);
      saveTodos();
      renderTodos();
    }

    function switchTodoTab(tab) {
      document.getElementById('todo-personal').classList.toggle('active', tab === 'personal');
      document.getElementById('todo-roadmap').classList.toggle('active', tab === 'roadmap');
      document.getElementById('tab-personal').classList.toggle('active', tab === 'personal');
      document.getElementById('tab-roadmap').classList.toggle('active', tab === 'roadmap');
    }

    renderTodos();

    // ── Scroll-driven bidirectional animation ──
    const heroSection = document.querySelector('.hero');
    const toolsSection = document.querySelector('.tools-section');
    const allCards = document.querySelectorAll('.tool-card');

    const isMobile = () => window.innerWidth <= 768;

    function initAnimationState() {
      if (isMobile()) {
        // Mobile: everything visible, no animation
        heroSection.style.transform = '';
        heroSection.style.opacity = '';
        toolsSection.style.transform = '';
        toolsSection.style.opacity = '';
        allCards.forEach(card => {
          card.style.transform = '';
          card.style.opacity = '';
        });
      } else {
        // Desktop: tools hidden initially
        toolsSection.style.opacity = '0';
        toolsSection.style.transform = 'translateY(80px)';
        allCards.forEach(card => {
          card.style.opacity = '0';
          card.style.transform = 'translateY(60px)';
        });
      }
    }

    function updateScrollAnimations() {
      if (isMobile()) return;
      const scrollY = window.scrollY;
      const heroHeight = heroSection.offsetHeight;
      const triggerPoint = heroHeight * 0.35;

      if (scrollY > triggerPoint) {
        const progress = Math.min((scrollY - triggerPoint) / (heroHeight * 0.45), 1);
        heroSection.style.transform = `translateY(${-progress * 80}px)`;
        heroSection.style.opacity = Math.max(1 - progress * 1.3, 0);
        const toolsProgress = Math.min(progress * 1.3, 1);
        toolsSection.style.transform = `translateY(${(1 - toolsProgress) * 80}px)`;
        toolsSection.style.opacity = toolsProgress;
        allCards.forEach((card, i) => {
          const delay = i * 0.1;
          const cardP = Math.max(Math.min((toolsProgress - delay) / 0.6, 1), 0);
          card.style.transform = `translateY(${(1 - cardP) * 60}px)`;
          card.style.opacity = cardP;
        });
      } else {
        heroSection.style.transform = 'translateY(0)';
        heroSection.style.opacity = '1';
        toolsSection.style.transform = `translateY(80px)`;
        toolsSection.style.opacity = '0';
        allCards.forEach(card => {
          card.style.transform = 'translateY(60px)';
          card.style.opacity = '0';
        });
      }
    }

    initAnimationState();
    updateScrollAnimations();
    window.addEventListener('scroll', updateScrollAnimations, { passive: true });
    window.addEventListener('resize', () => {
      initAnimationState();
      updateScrollAnimations();
    });

    // ── Scroll blur intensity ──
    const scrollFade = document.querySelector('.scroll-fade');
    window.addEventListener('scroll', () => {
      const scrollY = window.scrollY;
      const intensity = Math.min(scrollY / 300, 1);
      scrollFade.style.opacity = 0.4 + intensity * 0.6;
    });

    // ── Modals ──
    function openModal(id) {
      document.getElementById(`modal-${id}`).classList.add('active');
    }

    function closeModal(id) {
      document.getElementById(`modal-${id}`).classList.remove('active');
    }

    // ── Rank Progression Modal ──
    const RANK_UNLOCKS = {
      150:  'Unlocks: Ravi Gupta',
      450:  'Unlocks: Anubhav Bassi + Ashish Solanki',
      750:  'Unlocks: Kaustubh Aggarwal',
      1050: 'Unlocks: Madhur Virli',
    };

    function openRankModal() {
      const list = document.getElementById('rankList');
      list.innerHTML = '';
      let cumulative = 0;
      const lvl = getCurrentLevel();

      LEVELS.forEach((level, i) => {
        const rankStart = cumulative;
        const rankEnd = level.max === Infinity ? '∞' : cumulative + level.max;
        const isCompleted = i < lvl.idx;
        const isCurrent = i === lvl.idx;
        const unlockNote = RANK_UNLOCKS[rankStart] || '';

        const row = document.createElement('div');
        row.className = `rank-row${isCompleted ? ' completed' : ''}${isCurrent ? ' current' : ''}`;

        const progressPct = isCurrent ? Math.min(100, (lvl.earned / lvl.max) * 100) : isCompleted ? 100 : 0;
        const xpLabel = level.max === Infinity
          ? `${rankStart} XP+`
          : `${rankStart} – ${rankEnd} XP`;

        row.innerHTML = `
          <div class="rank-connector"></div>
          <div class="rank-indicator"></div>
          <div class="rank-info">
            <div class="rank-name">${level.name}</div>
            <div class="rank-xp-range">${xpLabel}</div>
            ${unlockNote ? `<div class="rank-unlock">🔓 ${unlockNote}</div>` : ''}
            ${isCurrent ? `
              <div class="rank-progress-mini">
                <div class="rank-progress-mini-fill" style="width:${progressPct}%"></div>
              </div>
            ` : ''}
          </div>
          ${isCurrent ? '<div class="rank-you-are-here">YOU ARE HERE</div>' : ''}
        `;

        list.appendChild(row);
        if (level.max !== Infinity) cumulative += level.max;
      });

      document.getElementById('rankModal').classList.add('active');
    }

    function closeRankModal() {
      document.getElementById('rankModal').classList.remove('active');
    }

    // Close on overlay click
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', e => {
        if (e.target === overlay) overlay.classList.remove('active');
      });
    });

    // ── API Calls ──
    async function callAPI(endpoint, body) {
      const res = await fetch(endpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      return res.json();
    }

    function setLoading(btn, loading) {
      btn.disabled = loading;
      btn.innerHTML = loading ? '<span class="spinner"></span> THINKING...' : btn.dataset.label;
    }

    function switchLinkedInType(type) {
      document.getElementById('linkedin-type').value = type;
      const labels = {
        post: 'Your LinkedIn Post',
        bio: 'Your LinkedIn About / Bio',
        headline: 'Your LinkedIn Headline',
        connection_request: 'Your Connection Request Message'
      };
      const placeholders = {
        post: 'Paste your LinkedIn post here...',
        bio: 'Paste your LinkedIn About section here...',
        headline: 'Paste your LinkedIn headline here...',
        connection_request: 'Paste your connection request message here...'
      };
      document.getElementById('linkedin-content-label').innerText = labels[type] || 'Your Content';
      document.getElementById('linkedin-content').placeholder = placeholders[type] || 'Paste your content here...';
      ['post','bio','headline','connect'].forEach(t => {
        const btnId = 'btn-li-' + t;
        const el = document.getElementById(btnId);
        if (el) el.classList.remove('active');
      });
      const activeId = type === 'connection_request' ? 'btn-li-connect' : 'btn-li-' + type;
      const activeEl = document.getElementById(activeId);
      if (activeEl) activeEl.classList.add('active');
    }

    // ── LINKEDIN ──
    let liMode = 'check'; // 'check' | 'create'
    let liCreateType = 'post';

    function switchLiMode(mode) {
      liMode = mode;
      document.getElementById('li-mode-check').classList.toggle('active', mode === 'check');
      document.getElementById('li-mode-create').classList.toggle('active', mode === 'create');
      document.getElementById('li-tab-check').classList.toggle('active', mode === 'check');
      document.getElementById('li-tab-create').classList.toggle('active', mode === 'create');
      const sub = document.getElementById('li-modal-sub');
      const btn = document.getElementById('li-submit-btn');
      if (mode === 'create') {
        sub.innerText = '// tell us what you want to say. we\'ll write it.';
        btn.innerText = 'WRITE IT 💼';
        btn.dataset.label = 'WRITE IT 💼';
      } else {
        sub.innerText = '// paste it. we\'ll tell you if it slaps or flops.';
        btn.innerText = 'CHECK IT 💼';
        btn.dataset.label = 'CHECK IT 💼';
      }
    }

    function switchLinkedInCreateType(type) {
      document.getElementById('linkedin-create-type').value = type;
      ['post','bio','headline','connect'].forEach(t => {
        const id = `btn-li-create-${t}`;
        const el = document.getElementById(id);
        if (el) el.classList.toggle('active', t === type || (type === 'connection_request' && t === 'connect'));
      });
      const labels = {
        post: 'What do you want to say?',
        bio: 'Tell us about yourself',
        headline: 'What do you do?',
        connection_request: 'Why are you reaching out?'
      };
      const placeholders = {
        post: 'e.g. I just shipped my first open source project, want to share it without sounding like a corporate drone...',
        bio: 'e.g. CSE student at PTU, building ANVIL — an AI roast platform. Interested in backend and developer tools...',
        headline: 'e.g. Backend dev, building with Flask and Groq. Open to internships.',
        connection_request: 'e.g. I want to reach out to a startup founder whose YC application video I watched — want to ask about their early days.'
      };
      document.getElementById('li-intent-label').innerText = labels[type] || labels['post'];
      document.getElementById('linkedin-intent').placeholder = placeholders[type] || placeholders['post'];
    }

    async function submitLinkedIn() {
      const btn = document.getElementById('li-submit-btn');
      const comic = document.getElementById('roaster-comic').value;
      setLoading(btn, true);

      let data;
      if (liMode === 'create') {
        const intent = document.getElementById('linkedin-intent').value.trim();
        if (!intent) { setLoading(btn, false); return alert('Tell us what you want to say first!'); }
        const content_type = document.getElementById('linkedin-create-type').value;
        data = await callAPI('/api/linkedin', { mode: 'create', intent, content_type, comic });
      } else {
        const content = document.getElementById('linkedin-content').value.trim();
        const content_type = document.getElementById('linkedin-type').value;
        if (!content) { setLoading(btn, false); return alert('Paste your LinkedIn content first!'); }
        data = await callAPI('/api/linkedin', { mode: 'check', content, content_type, comic });
      }

      setLoading(btn, false);
      document.getElementById('verdict-waiting').style.display = 'none';
      document.getElementById('verdict-result').style.display = 'block';

      const raw = data.message || '';

      if (liMode === 'create') {
        const createdMatch = raw.match(/(?:\[CREATED\])([\s\S]*?)$/i);
        const createdText = createdMatch ? createdMatch[1].trim() : raw;
        document.getElementById('roaster-text').innerText = createdText;
        document.getElementById('linkedin-verdict-label').innerText = '// ready to copy and paste ↑';
        document.getElementById('linkedin-fixed-text').innerText = '';
      } else {
        const verdictMatch = raw.match(/(?:\[VERDICT\]|#\s*VERDICT)([\s\S]*?)(?=(?:\[FIXED\]|#\s*FIXED)|$)/i);
        const fixedMatch = raw.match(/(?:\[FIXED\]|#\s*FIXED)([\s\S]*?)$/i);
        document.getElementById('roaster-text').innerText = verdictMatch ? verdictMatch[1].trim() : raw;
        const fixedText = fixedMatch ? fixedMatch[1].trim() : '';
        if (fixedText) {
          document.getElementById('linkedin-fixed-text').innerText = fixedText;
          document.getElementById('linkedin-verdict-label').innerText = '// fixed version ↓';
        }
      }

      const earned = addXP(25);
      document.getElementById('roaster-xp').innerText = `+${earned} XP earned!`;
      showXPFloat(earned, btn);
      document.getElementById('roaster-share-btn').classList.add('visible');
    }

    // ── IDEA ──
    let ideaMode = 'check';


    // ── CHIP SELECTOR ──
    function selectChip(el, groupId) {
      document.querySelectorAll('#' + groupId + ' .q-chip').forEach(c => c.classList.remove('selected'));
      el.classList.add('selected');
    }

    function getChipValue(groupId) {
      const sel = document.querySelector('#' + groupId + ' .q-chip.selected');
      return sel ? sel.innerText : '';
    }

    // ── IDEA QUESTIONNAIRE NAV ──
    let ideaQStep = 0;
    const IDEA_STEP_LABELS = ['Step 1 of 3 — Who are you?', 'Step 2 of 3 — What drives you?', 'Step 3 of 3 — Reality check'];

    function ideaNextStep(to) {
      document.getElementById('idea-qp-' + ideaQStep).classList.remove('active');
      document.getElementById('idea-dot-' + ideaQStep).classList.remove('active');
      document.getElementById('idea-dot-' + ideaQStep).classList.add('done');
      ideaQStep = to;
      document.getElementById('idea-qp-' + ideaQStep).classList.add('active');
      document.getElementById('idea-dot-' + ideaQStep).classList.add('active');
      if (ideaQStep < 3) document.getElementById('idea-dot-' + ideaQStep).classList.remove('done');
      document.getElementById('idea-q-label').innerText = IDEA_STEP_LABELS[ideaQStep];
    }

    // ── STACK QUESTIONNAIRE NAV ──
    let stackQStep = 0;
    const STACK_STEP_LABELS = ['Step 1 of 3 — Your level', 'Step 2 of 3 — Your goal', 'Step 3 of 3 — Interests & constraints'];

    function stackNextStep(to) {
      document.getElementById('stack-qp-' + stackQStep).classList.remove('active');
      document.getElementById('stack-dot-' + stackQStep).classList.remove('active');
      document.getElementById('stack-dot-' + stackQStep).classList.add('done');
      stackQStep = to;
      document.getElementById('stack-qp-' + stackQStep).classList.add('active');
      document.getElementById('stack-dot-' + stackQStep).classList.add('active');
      if (stackQStep < 3) document.getElementById('stack-dot-' + stackQStep).classList.remove('done');
      document.getElementById('stack-q-label').innerText = STACK_STEP_LABELS[stackQStep];
    }

    function switchIdeaMode(mode) {
      ideaMode = mode;
      document.getElementById('idea-mode-check').classList.toggle('active', mode === 'check');
      document.getElementById('idea-mode-create').classList.toggle('active', mode === 'create');
      document.getElementById('idea-tab-check').classList.toggle('active', mode === 'check');
      document.getElementById('idea-tab-create').classList.toggle('active', mode === 'create');
      const btn = document.getElementById('idea-submit-btn');
      if (mode === 'create') {
        btn.innerText = 'GENERATE IDEAS 💡';
        btn.dataset.label = 'GENERATE IDEAS 💡';
        // reset questionnaire to step 0
        if (ideaQStep !== 0) ideaNextStep(0);
      } else {
        btn.innerText = 'CHECK MY IDEA 💡';
        btn.dataset.label = 'CHECK MY IDEA 💡';
      }
    }

    async function submitIdea() {
      const btn = document.getElementById('idea-submit-btn');
      const comic = document.getElementById('roaster-comic') ? document.getElementById('roaster-comic').value : 'abhishek_upmanyu';
      setLoading(btn, true);

      let data;
      if (ideaMode === 'create') {
        const skills = document.getElementById('idea-skills').value.trim();
        const interests = document.getElementById('idea-interests').value.trim();
        const edge = document.getElementById('idea-edge').value.trim();
        const role = getChipValue('idea-chips-role');
        const market = getChipValue('idea-chips-market');
        const ideaType = getChipValue('idea-chips-type');
        const time = getChipValue('idea-chips-time');
        const budget = getChipValue('idea-chips-budget');
        const team = getChipValue('idea-chips-team');
        if (!skills || !interests) { setLoading(btn, false); return alert('Fill in at least your skills and interests!'); }
        data = await callAPI('/api/idea', { mode: 'create', skills, interests, edge, role, market, idea_type: ideaType, time, budget, team, comic });
      } else {
        const idea = document.getElementById('idea-input').value;
        const market = document.getElementById('idea-market').value;
        if (!idea || !market) { setLoading(btn, false); return alert('Fill in all fields!'); }
        data = await callAPI('/api/idea', { mode: 'check', idea, market, comic });
      }

      setLoading(btn, false);
      document.getElementById('idea-verdict-waiting').style.display = 'none';
      document.getElementById('idea-verdict-result').style.display = 'block';

      const raw = data.message || '';
      if (ideaMode === 'create') {
        const match = raw.match(/(?:\[CREATED\])([\s\S]*?)$/i);
        document.getElementById('idea-text').innerText = match ? match[1].trim() : raw;
      } else {
        document.getElementById('idea-text').innerText = raw;
      }

      const earned = addXP(30);
      document.getElementById('idea-xp').innerText = `+${earned} XP earned!`;
      showXPFloat(earned, btn);
      document.getElementById('idea-share-btn').classList.add('visible');
    }

    // ── STACK ──
    let stackMode = 'check';

    function switchStackMode(mode) {
      stackMode = mode;
      document.getElementById('stack-mode-check').classList.toggle('active', mode === 'check');
      document.getElementById('stack-mode-create').classList.toggle('active', mode === 'create');
      document.getElementById('stack-tab-check').classList.toggle('active', mode === 'check');
      document.getElementById('stack-tab-create').classList.toggle('active', mode === 'create');
      const btn = document.getElementById('stack-submit-btn');
      if (mode === 'create') {
        btn.innerText = 'SUGGEST A PROJECT ⚙️';
        btn.dataset.label = 'SUGGEST A PROJECT ⚙️';
      } else {
        btn.innerText = 'PICK MY STACK ⚙️';
        btn.dataset.label = 'PICK MY STACK ⚙️';
      }
    }

    async function submitStack() {
      const btn = document.getElementById('stack-submit-btn');
      const comic = document.getElementById('roaster-comic') ? document.getElementById('roaster-comic').value : 'abhishek_upmanyu';
      setLoading(btn, true);

      let data;
      if (stackMode === 'create') {
        const interests = document.getElementById('stack-interests').value.trim();
        const shipped = document.getElementById('stack-shipped').value.trim();
        const known = document.getElementById('stack-known').value.trim();
        const learn = document.getElementById('stack-learn').value.trim();
        const exp = getChipValue('stack-chips-exp');
        const pref = getChipValue('stack-chips-pref');
        const goal = getChipValue('stack-chips-goal');
        const time = getChipValue('stack-chips-time');
        const deadline = getChipValue('stack-chips-deadline');
        if (!interests) { setLoading(btn, false); return alert('Tell us what domains interest you!'); }
        data = await callAPI('/api/stack', { mode: 'create', interests, shipped, known, learn, exp, pref, goal, time, deadline, comic });
      } else {
        const project = document.getElementById('stack-project').value;
        const level = document.getElementById('stack-level').value;
        const priority = document.getElementById('stack-priority').value;
        if (!project) { setLoading(btn, false); return alert('Describe your project!'); }
        data = await callAPI('/api/stack', { mode: 'check', project, level, priority, comic });
      }

      setLoading(btn, false);
      document.getElementById('stack-verdict-waiting').style.display = 'none';
      document.getElementById('stack-verdict-result').style.display = 'block';

      const raw = data.message || '';
      if (stackMode === 'create') {
        const match = raw.match(/(?:\[CREATED\])([\s\S]*?)$/i);
        document.getElementById('stack-text').innerText = match ? match[1].trim() : raw;
      } else {
        document.getElementById('stack-text').innerText = raw;
      }

      const earned = addXP(20);
      document.getElementById('stack-xp').innerText = `+${earned} XP earned!`;
      showXPFloat(earned, btn);
      document.getElementById('stack-share-btn').classList.add('visible');
    }

    // ── RESUME ──
    let resumeCurrentMode = 'paste';
    let resumeMainTab = 'check'; // 'check' | 'create'

    function switchResumeMainMode(tab) {
      resumeMainTab = tab;
      document.getElementById('resume-main-check').classList.toggle('active', tab === 'check');
      document.getElementById('resume-main-create').classList.toggle('active', tab === 'create');
      document.getElementById('resume-tab-check').classList.toggle('active', tab === 'check');
      document.getElementById('resume-tab-create').classList.toggle('active', tab === 'create');
      const btn = document.getElementById('resume-submit-btn');
      const sub = document.getElementById('resume-modal-sub');
      if (tab === 'create') {
        resumeCurrentMode = 'create';
        btn.innerText = 'BUILD MY RESUME 📄';
        btn.dataset.label = 'BUILD MY RESUME 📄';
        sub.innerText = '// tell us who you are. we\'ll write the resume.';
      } else {
        resumeCurrentMode = 'paste';
        btn.innerText = 'ROAST MY RESUME 📄';
        btn.dataset.label = 'ROAST MY RESUME 📄';
        sub.innerText = '// we\'ll fix it. but we won\'t be nice about it.';
        // restore sub-mode
        switchResumeMode(resumeCurrentMode === 'create' ? 'paste' : resumeCurrentMode);
      }
    }

    function switchResumeMode(mode) {
      resumeCurrentMode = mode;
      document.getElementById('resume-mode-paste').classList.toggle('active', mode === 'paste');
      document.getElementById('resume-mode-form').classList.toggle('active', mode === 'form');
      document.getElementById('btn-paste').classList.toggle('active', mode === 'paste');
      document.getElementById('btn-form').classList.toggle('active', mode === 'form');
    }

    async function submitResume(btn) {
      const comic = document.getElementById('resume-comic').value;
      let body = { comic };

      if (resumeMainTab === 'create') {
        body.mode = 'create';
        const name = document.getElementById('create-name').value.trim();
        if (!name) return alert('Fill in at least your name!');
        body.name = name;
        body.role = document.getElementById('create-role').value;
        body.experience = document.getElementById('create-experience').value;
        body.projects = document.getElementById('create-projects').value;
        body.skills = document.getElementById('create-skills').value;
        body.education = document.getElementById('create-education').value;
      } else if (resumeCurrentMode === 'paste') {
        body.mode = 'paste';
        const text = document.getElementById('resume-text').value.trim();
        if (!text) return alert('Paste your resume first!');
        body.resume_text = text;
      } else {
        body.mode = 'form';
        const name = document.getElementById('form-name').value.trim();
        if (!name) return alert('Fill in at least your name!');
        body.name = name;
        body.role = document.getElementById('form-role').value;
        body.experience = document.getElementById('form-experience').value;
        body.projects = document.getElementById('form-projects').value;
        body.skills = document.getElementById('form-skills').value;
        body.education = document.getElementById('form-education').value;
      }

      btn.dataset.label = btn.innerText;
      setLoading(btn, true);
      const data = await callAPI('/api/resume', body);
      setLoading(btn, false);

      const raw = data.message || '';
      document.getElementById('resume-verdict-waiting').style.display = 'none';
      document.getElementById('resume-verdict-result').style.display = 'flex';

      if (resumeMainTab === 'create') {
        const match = raw.match(/(?:\[CREATED\])([\s\S]*?)$/i);
        const createdText = match ? match[1].trim() : raw;
        document.getElementById('resume-roast-section').style.display = 'none';
        document.getElementById('resume-fixed-label').innerText = '// your resume — ready to use';
        document.getElementById('resume-fixed-text').innerText = createdText;
        document.getElementById('resume-why-section').style.display = 'none';
      } else {
        document.getElementById('resume-roast-section').style.display = '';
        document.getElementById('resume-fixed-label').innerText = '// fixed version';
        const roastMatch = raw.match(/(?:\[ROAST\]|#\s*ROAST)([\s\S]*?)(?=(?:\[FIXED\]|#\s*FIXED|\[WHY\]|#\s*WHY)|$)/i);
        const fixedMatch = raw.match(/(?:\[FIXED\]|#\s*FIXED)([\s\S]*?)(?=(?:\[WHY\]|#\s*WHY)|$)/i);
        const whyMatch = raw.match(/(?:\[WHY\]|#\s*WHY)([\s\S]*?)$/i);
        document.getElementById('resume-roast-text').innerText = roastMatch ? roastMatch[1].trim() : raw;
        document.getElementById('resume-fixed-text').innerText = fixedMatch ? fixedMatch[1].trim() : '(no fix returned — try again)';
        if (whyMatch && whyMatch[1].trim()) {
          document.getElementById('resume-why-text').innerText = whyMatch[1].trim();
          document.getElementById('resume-why-section').style.display = 'block';
        } else {
          document.getElementById('resume-why-section').style.display = 'none';
        }
      }

      const earned = addXP(35);
      document.getElementById('resume-xp').innerText = `+${earned} XP earned!`;
      showXPFloat(earned, btn);
      document.getElementById('resume-share-btn').classList.add('visible');
    }

    // ── Share Card ──
    let shareTemplate = 'halftone';
    let shareRatio = '1:1';
    let shareData = {};

    const SHARE_RATIOS = {
      '1:1': { w: 600, h: 600 },
      '4:5': { w: 600, h: 750 },
      '9:16': { w: 600, h: 1067 },
    };

    const TOOL_META = {
      roaster: { name: 'LINKEDIN REALITY CHECK', icon: '💼', color: '#0077b5' },
      idea:    { name: 'IDEA CHECKER',            icon: '💡', color: '#ff6b6b' },
      stack:   { name: 'STACK PICKER',            icon: '⚙️', color: '#00e676' },
      resume:  { name: 'RESUME ROASTER',          icon: '📄', color: '#a855f7' },
    };

    function openSharePanel(tool) {
      let resultText = '';
      if (tool === 'resume') {
        const roast = document.getElementById('resume-roast-text')?.innerText || '';
        const fixed = document.getElementById('resume-fixed-text')?.innerText || '';
        resultText = roast; // share the roast section
      } else {
        const textEl = document.getElementById(tool === 'roaster' ? 'roaster-text' : tool + '-text');
        resultText = textEl ? textEl.innerText : '';
      }
      const comic = (tool === 'roaster' || tool === 'resume')
        ? document.getElementById(tool + '-comic')?.options[document.getElementById(tool + '-comic')?.selectedIndex]?.text
        : '';
      const lvl = getCurrentLevel();
      shareData = {
        tool,
        text: resultText,
        comic: comic || '',
        color: TOOL_META[tool].color,
        toolName: TOOL_META[tool].name,
        icon: TOOL_META[tool].icon,
        level: `LVL ${lvl.idx + 1} — ${lvl.name}`,
        xp: xp + ' XP',
      };
      document.getElementById('shareOverlay').classList.add('active');
      document.body.style.overflow = 'hidden';
      renderShareCard();
    }

    function closeSharePanel() {
      document.getElementById('shareOverlay').classList.remove('active');
      document.body.style.overflow = '';
    }

    function setShareTemplate(t) {
      shareTemplate = t;
      document.querySelectorAll('.share-switch-btn').forEach(b => b.classList.remove('active'));
      document.getElementById('tmpl-' + t).classList.add('active');
      renderShareCard();
    }

    function setShareRatio(r) {
      shareRatio = r;
      document.querySelectorAll('.share-ratio-btn').forEach(b => b.classList.remove('active'));
      const map = {'1:1':'ratio-1','4:5':'ratio-2','9:16':'ratio-3'};
      document.getElementById(map[r]).classList.add('active');
      renderShareCard();
    }

    function renderShareCard() {
      const canvas = document.getElementById('shareCard');
      const { w, h } = SHARE_RATIOS[shareRatio];
      canvas.width = w;
      canvas.height = h;
      const ctx = canvas.getContext('2d');
      if (shareTemplate === 'halftone') drawShareHalftone(ctx, w, h);
      else drawShareMesh(ctx, w, h);
    }

    function drawShareHalftone(ctx, w, h) {
      ctx.fillStyle = '#0a0a0a';
      ctx.fillRect(0, 0, w, h);

      // Halftone dots — fade from center
      const dotSpacing = 22;
      const maxR = 5;
      const centerX = w * 0.5;
      const centerY = h * 0.5;
      const maxDist = Math.sqrt(w * w + h * h) * 0.32;
      for (let x = 0; x < w + dotSpacing; x += dotSpacing) {
        for (let y = 0; y < h + dotSpacing; y += dotSpacing) {
          const dist = Math.sqrt((x-centerX)**2 + (y-centerY)**2);
          const t = Math.min(dist / maxDist, 1);
          const fade = t * t;
          const r = maxR * t * 1.2;
          const opacity = fade * 0.18;
          if (r > 0.3 && opacity > 0.01) {
            ctx.beginPath();
            ctx.arc(x, y, Math.min(r, maxR), 0, Math.PI * 2);
            ctx.fillStyle = `rgba(255,77,0,${opacity})`;
            ctx.fill();
          }
        }
      }

      // Top accent bar
      ctx.fillStyle = shareData.color;
      ctx.fillRect(0, 0, w, 6);

      const pad = w * 0.1;
      const topY = h * 0.12;

      // Tool label (left)
      ctx.font = `${w * 0.035}px 'DM Mono', monospace`;
      ctx.fillStyle = 'rgba(255,255,255,0.35)';
      ctx.fillText('// ' + shareData.toolName, pad, topY);

      // XP + Level badge — below tool name to avoid overlap
      const levelY = topY + w * 0.052;
      ctx.textAlign = 'right';
      ctx.font = `bold ${w * 0.036}px 'Bebas Neue', sans-serif`;
      ctx.fillStyle = '#ffcc00';
      ctx.fillText('⚡ ' + shareData.level, w - pad, levelY);
      ctx.font = `${w * 0.024}px 'DM Mono', monospace`;
      ctx.fillStyle = 'rgba(255,204,0,0.55)';
      ctx.fillText(shareData.xp, w - pad, levelY + w * 0.038);
      ctx.textAlign = 'left';

      // Icon
      ctx.font = `${w * 0.07}px Arial`;
      ctx.fillText(shareData.icon, pad, topY + w * 0.1);

      // Comic style
      if (shareData.comic) {
        ctx.font = `500 ${w * 0.03}px 'DM Sans', sans-serif`;
        ctx.fillStyle = shareData.color;
        ctx.fillText(shareData.comic, pad + w * 0.1, topY + w * 0.082);
      }

      // Divider
      const lineY = topY + w * 0.13;
      ctx.strokeStyle = 'rgba(255,255,255,0.1)';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(pad, lineY);
      ctx.lineTo(w - pad, lineY);
      ctx.stroke();

      // Result text — bounded region
      const bottomY = h - h * 0.1;
      const textY = lineY + h * 0.07;
      const fontSize = Math.min(w * 0.042, h * 0.028);
      const textMaxY = bottomY - h * 0.06;
      ctx.font = `300 ${fontSize}px 'DM Sans', sans-serif`;
      ctx.fillStyle = '#e0e0e0';
      wrapShareText(ctx, shareData.text, pad, textY, w - pad * 2, fontSize * 1.8, textMaxY);

      // Watermark only at bottom
      ctx.font = `${w * 0.048}px 'Bebas Neue', sans-serif`;
      ctx.fillStyle = 'rgba(255,255,255,0.28)';
      ctx.textAlign = 'right';
      ctx.fillText('ANVIL', w - pad, bottomY + h * 0.035);
      ctx.textAlign = 'left';

      // Bottom accent
      ctx.fillStyle = shareData.color;
      ctx.fillRect(0, h - 4, w, 4);
    }

    function drawShareMesh(ctx, w, h) {
      ctx.fillStyle = '#080808';
      ctx.fillRect(0, 0, w, h);

      const blobs = [
        { x: w*0.2, y: h*0.2, r: w*0.55, c: 'rgba(255,77,0,0.12)' },
        { x: w*0.8, y: h*0.5, r: w*0.45, c: 'rgba(255,100,20,0.08)' },
        { x: w*0.3, y: h*0.8, r: w*0.5,  c: 'rgba(255,60,0,0.1)' },
        { x: w*0.7, y: h*0.15,r: w*0.3,  c: 'rgba(255,180,0,0.06)' },
      ];
      blobs.forEach(b => {
        const grad = ctx.createRadialGradient(b.x, b.y, 0, b.x, b.y, b.r);
        grad.addColorStop(0, b.c);
        grad.addColorStop(1, 'transparent');
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, w, h);
      });

      ctx.strokeStyle = 'rgba(255,77,0,0.05)';
      ctx.lineWidth = 0.5;
      for (let x = 0; x < w; x += 40) { ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,h); ctx.stroke(); }
      for (let y = 0; y < h; y += 40) { ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(w,y); ctx.stroke(); }

      const cp = w*0.08, cx = cp, cy = h*0.08, cw = w-cp*2, ch = h-h*0.16;
      ctx.fillStyle = 'rgba(255,255,255,0.03)';
      shareRoundRect(ctx, cx, cy, cw, ch, 12); ctx.fill();
      ctx.strokeStyle = 'rgba(255,77,0,0.25)'; ctx.lineWidth = 1;
      shareRoundRect(ctx, cx, cy, cw, ch, 12); ctx.stroke();
      ctx.fillStyle = shareData.color;
      shareRoundRect(ctx, cx, cy, cw, 3, [12,12,0,0]); ctx.fill();

      const pad = cx + cw*0.1;
      const topY = cy + ch*0.12;

      // Tool label (left)
      ctx.font = `${w*0.033}px 'DM Mono', monospace`;
      ctx.fillStyle = 'rgba(255,255,255,0.3)';
      ctx.fillText('// ' + shareData.toolName, pad, topY);

      // XP + Level badge — below tool name to avoid overlap
      const badgeX = cx + cw - cw*0.1;
      const meshLevelY = topY + w * 0.052;
      ctx.textAlign = 'right';
      ctx.font = `bold ${w*0.036}px 'Bebas Neue', sans-serif`;
      ctx.fillStyle = '#ffcc00';
      ctx.fillText('⚡ ' + shareData.level, badgeX, meshLevelY);
      ctx.font = `${w*0.024}px 'DM Mono', monospace`;
      ctx.fillStyle = 'rgba(255,204,0,0.55)';
      ctx.fillText(shareData.xp, badgeX, meshLevelY + w*0.038);
      ctx.textAlign = 'left';

      // Icon + comic
      ctx.font = `${w*0.07}px Arial`;
      ctx.fillText(shareData.icon, pad, topY + w*0.1);

      if (shareData.comic) {
        ctx.font = `500 ${w*0.03}px 'DM Sans', sans-serif`;
        ctx.fillStyle = shareData.color;
        ctx.fillText(shareData.comic, pad + w*0.1, topY + w*0.082);
      }

      // Divider
      const lineY = topY + w*0.13;
      ctx.strokeStyle = 'rgba(255,77,0,0.2)'; ctx.lineWidth = 1;
      ctx.beginPath(); ctx.moveTo(pad, lineY); ctx.lineTo(cx+cw-cw*0.1, lineY); ctx.stroke();

      // Result text — bounded region
      const bottomY = cy + ch - ch*0.08;
      const textMaxY = bottomY - ch*0.08;
      const fontSize = Math.min(w*0.04, h*0.026);
      ctx.font = `300 ${fontSize}px 'DM Sans', sans-serif`;
      ctx.fillStyle = '#d0d0d0';
      wrapShareText(ctx, shareData.text, pad, lineY + ch*0.07, cw*0.8, fontSize*1.85, textMaxY);

      // Watermark bottom right only
      ctx.font = `${w*0.044}px 'Bebas Neue', sans-serif`;
      ctx.fillStyle = 'rgba(255,255,255,0.28)';
      ctx.textAlign = 'right';
      ctx.fillText('ANVIL', cx+cw-cw*0.1, bottomY + ch*0.03);
      ctx.textAlign = 'left';
    }

    function wrapShareText(ctx, text, x, y, maxWidth, lineHeight, maxY) {
      if (!text) return;
      const words = text.split(' ');
      let line = '', curY = y;
      const ellipsis = '...';
      for (let i = 0; i < words.length; i++) {
        const test = line + words[i] + ' ';
        if (ctx.measureText(test).width > maxWidth && i > 0) {
          // Check if next line would exceed maxY
          if (maxY && curY + lineHeight > maxY) {
            // Truncate current line with ellipsis
            while (ctx.measureText(line + ellipsis).width > maxWidth && line.length > 0) {
              line = line.slice(0, -1);
            }
            ctx.fillText(line.trim() + ellipsis, x, curY);
            return;
          }
          ctx.fillText(line, x, curY);
          line = words[i] + ' ';
          curY += lineHeight;
        } else { line = test; }
      }
      // Final line — truncate if needed
      if (maxY && curY > maxY) return;
      if (ctx.measureText(line).width > maxWidth) {
        while (ctx.measureText(line + ellipsis).width > maxWidth && line.length > 0) {
          line = line.slice(0, -1);
        }
        ctx.fillText(line.trim() + ellipsis, x, curY);
      } else {
        ctx.fillText(line, x, curY);
      }
    }

    function shareRoundRect(ctx, x, y, w, h, r) {
      if (typeof r === 'number') r = [r,r,r,r];
      ctx.beginPath();
      ctx.moveTo(x+r[0], y);
      ctx.lineTo(x+w-r[1], y); ctx.quadraticCurveTo(x+w, y, x+w, y+r[1]);
      ctx.lineTo(x+w, y+h-r[2]); ctx.quadraticCurveTo(x+w, y+h, x+w-r[2], y+h);
      ctx.lineTo(x+r[3], y+h); ctx.quadraticCurveTo(x, y+h, x, y+h-r[3]);
      ctx.lineTo(x, y+r[0]); ctx.quadraticCurveTo(x, y, x+r[0], y);
      ctx.closePath();
    }

    function downloadShareCard() {
      const canvas = document.getElementById('shareCard');
      const link = document.createElement('a');
      link.download = `anvil-${shareTemplate}-${shareRatio.replace(':','-')}.png`;
      link.href = canvas.toDataURL('image/png');
      link.click();
    }

    // Close share on overlay click
    document.getElementById('shareOverlay').addEventListener('click', e => {
      if (e.target === document.getElementById('shareOverlay')) closeSharePanel();
    });
  </script>

  <!-- Share Overlay -->
  <div class="share-overlay" id="shareOverlay">
    <div class="share-panel">
      <button class="share-close" onclick="closeSharePanel()">✕</button>

      <div class="share-controls">
        <div class="share-control-group">
          <div class="share-control-label">Template</div>
          <div class="share-switcher">
            <button class="share-switch-btn active" id="tmpl-halftone" onclick="setShareTemplate('halftone')">
              <span class="sdot"></span>HALFTONE
            </button>
            <button class="share-switch-btn" id="tmpl-mesh" onclick="setShareTemplate('mesh')">
              <span class="sdot"></span>MESH
            </button>
          </div>
        </div>

        <div class="share-control-group">
          <div class="share-control-label">Aspect Ratio</div>
          <div class="share-ratio-switcher">
            <button class="share-ratio-btn active" id="ratio-1" onclick="setShareRatio('1:1')">
              <div class="share-ratio-icon sq"></div>
              <span class="ratio-label">1:1</span>
              <span class="ratio-hint">Twitter / FB</span>
            </button>
            <button class="share-ratio-btn" id="ratio-2" onclick="setShareRatio('4:5')">
              <div class="share-ratio-icon pt"></div>
              <span class="ratio-label">4:5</span>
              <span class="ratio-hint">Instagram</span>
            </button>
            <button class="share-ratio-btn" id="ratio-3" onclick="setShareRatio('9:16')">
              <div class="share-ratio-icon st"></div>
              <span class="ratio-label">9:16</span>
              <span class="ratio-hint">Story</span>
            </button>
          </div>
        </div>

        <button class="share-download-btn" onclick="downloadShareCard()">⬇ DOWNLOAD</button>
      </div>

      <div class="share-divider"></div>

      <div class="share-preview-area">
        <div class="share-preview-label">// live preview</div>
        <div class="share-canvas-wrapper">
          <canvas id="shareCard"></canvas>
        </div>
      </div>
    </div>
  </div>
  <!-- FOOTER -->
  <footer class="site-footer">
    <span class="footer-credit">ANVIL</span>
    <span class="footer-dot">·</span>
    <span class="footer-tagline">Forged in Satire</span>
    <span class="footer-dot">·</span>
    <span class="footer-credit">© 2025 Pushkar Gupta</span>
  </footer>

  <!-- MOBILE DRAWER -->
  <div class="drawer-overlay" id="drawerOverlay" onclick="closeDrawer()"></div>
  <div class="drawer" id="drawer">
    <div class="drawer-header">
      <div>
        <div class="drawer-logo">AN<span>V</span>IL</div>
        <div class="drawer-tagline">Forged in Satire</div>
      </div>
    </div>
    <nav class="drawer-nav">
      <button class="drawer-link" onclick="drawerNav('tools')">
        <span class="drawer-link-icon">⚙️</span> Tools
      </button>
      <button class="drawer-link" onclick="drawerNav('leaderboard')">
        <span class="drawer-link-icon">⚡</span> Leaderboard
      </button>
      <button class="drawer-link" onclick="drawerNav('about')">
        <span class="drawer-link-icon">👤</span> About
      </button>
    </nav>
    <div class="drawer-footer">// built different. roasted fresh.</div>
  </div>

  <!-- LEADERBOARD MODAL -->
  <div class="lb-overlay" id="lbOverlay" onclick="if(event.target===this)closeLeaderboard()">
    <div class="lb-modal">
      <button class="lb-close" onclick="closeLeaderboard()">✕</button>
      <div class="lb-header">
        <div class="lb-title">LEADERBOARD</div>
        <div class="lb-sub">// who's getting roasted the most</div>
        <div class="lb-tabs">
          <button class="lb-tab active" id="lb-tab-global" onclick="switchLbTab('global')">⚡ GLOBAL</button>
          <button class="lb-tab" id="lb-tab-weekly" onclick="switchLbTab('weekly')">🔥 THIS WEEK</button>
          <button class="lb-tab" id="lb-tab-personal" onclick="switchLbTab('personal')">👤 PERSONAL</button>
        </div>
      </div>
      <div class="lb-body">
        <div class="lb-section active" id="lb-global">
          <div class="lb-loading" id="lb-global-loading">// loading rankings...</div>
          <div id="lb-global-list"></div>
        </div>
        <div class="lb-section" id="lb-weekly">
          <div class="lb-loading" id="lb-weekly-loading">// loading this week's grind...</div>
          <div id="lb-weekly-list"></div>
        </div>
        <div class="lb-section" id="lb-personal">
          <div id="lb-personal-content"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Logout Confirmation -->
  <div class="logout-confirm-overlay" id="logoutConfirm" onclick="if(event.target===this)cancelLogout()">
    <div class="logout-confirm-box">
      <div class="logout-confirm-title">SIGN OUT?</div>
      <div class="logout-confirm-sub">// your XP is saved. come back anytime.</div>
      <div class="logout-confirm-btns">
        <button class="logout-btn-cancel" onclick="cancelLogout()">STAY</button>
        <button class="logout-btn-confirm" onclick="doLogout()">SIGN OUT</button>
      </div>
    </div>
  </div>

</body>
</html>